(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{598:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/redis.png",alt:"redis"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_1-redis-概述安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis-概述安装"}},[s._v("#")]),s._v(" 1. Redis  概述安装")]),s._v(" "),a("ul",[a("li",[s._v("Redis是一个开源的key-value存储系统。")]),s._v(" "),a("li",[s._v("和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set --有序集合)和hash（哈希类型）。")]),s._v(" "),a("li",[s._v("这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。")]),s._v(" "),a("li",[s._v("在此基础上，Redis支持各种不同方式的排序。")]),s._v(" "),a("li",[s._v("与memcached一样，为了保证效率，数据都是缓存在内存中。")]),s._v(" "),a("li",[s._v("区别的是Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件。")]),s._v(" "),a("li",[s._v("并且在此基础上实现了master-slave(主从)同步。")])]),s._v(" "),a("h3",{attrs:{id:"_1-1-应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-应用场景"}},[s._v("#")]),s._v(" 1.1 应用场景")]),s._v(" "),a("blockquote",[a("h5",{attrs:{id:"配合关系型数据库做高速缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配合关系型数据库做高速缓存"}},[s._v("#")]),s._v(" 配合关系型数据库做高速缓存")])]),s._v(" "),a("ul",[a("li",[s._v("高频次，热门访问的数据，降低数据库IO")]),s._v(" "),a("li",[s._v("分布式架构，做session共享")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/1.1_1.png",alt:"截屏2021-07-15 15.36.10"}})]),s._v(" "),a("blockquote",[a("h5",{attrs:{id:"多样的数据结构存储持久化数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多样的数据结构存储持久化数据"}},[s._v("#")]),s._v(" 多样的数据结构存储持久化数据")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/1.1_2.png",alt:"image-20210715153643014"}})]),s._v(" "),a("h3",{attrs:{id:"_1-2-redis-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-redis-安装"}},[s._v("#")]),s._v(" 1.2 Redis  安装")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Redis官方网站")]),s._v(" "),a("th",[s._v("Redis中文官方网站")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("http://redis.io")]),s._v(" "),a("td",[s._v("http://redis.cn/")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/1.2_1.png",alt:"截屏2021-07-15 15.37.46"}})]),s._v(" "),a("h4",{attrs:{id:"安装版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装版本"}},[s._v("#")]),s._v(" 安装版本")]),s._v(" "),a("ul",[a("li",[s._v("6.2.1 for Linux（redis-6.2.1.tar.gz）")]),s._v(" "),a("li",[s._v("不用考虑在windows环境下对Redis的支持")])]),s._v(" "),a("h4",{attrs:{id:"安装步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),a("ol",{attrs:{start:"0"}},[a("li",[s._v("准备工作：下载安装最新版的gcc  编译器")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装C 语言的编译环境")]),s._v("\nyum   ins  tall centos-release-scl scl-utils-build \nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y devtoolset-8-toolchain \nscl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" devtoolset-8 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" \n\n测试   gcc  版本  \ngcc   --  version \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ol",[a("li",[a("p",[s._v("下载redis-6.2.1.tar.gz放/opt目录")])]),s._v(" "),a("li",[a("p",[s._v("解压命令：tar -zxvf redis-6.2.1.tar.gz")])]),s._v(" "),a("li",[a("p",[s._v("解压完成后进入目录：cd redis-6.2.1")])]),s._v(" "),a("li",[a("p",[s._v("在redis-6.2.1目录下再次执行make命令（只是编译好）")])]),s._v(" "),a("li",[a("p",[s._v("如果没有准备好C语言编译环境，make 会报错: "),a("code",[s._v("Jemalloc/jemalloc.h：没有那个文件")])])]),s._v(" "),a("li",[a("p",[s._v("解决方案：运行make distclean")])]),s._v(" "),a("li",[a("p",[s._v("在redis-6.2.1目录下再次执行make命令（只是编译好）")])]),s._v(" "),a("li",[a("p",[s._v("跳过  make test 继续执行: make install")])])]),s._v(" "),a("h4",{attrs:{id:"安装目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装目录"}},[s._v("#")]),s._v(" 安装目录")]),s._v(" "),a("blockquote",[a("p",[s._v("/ usr/local/bin")])]),s._v(" "),a("p",[s._v("查看默认安装目录：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("redis-benchmark:性能测试工具，可以在自己本子运行，看看自己本子性能如何")])]),s._v(" "),a("li",[a("p",[s._v("redis-check-aof：修复有问题的AOF文件，rdb和aof后面讲")])]),s._v(" "),a("li",[a("p",[s._v("redis-check-dump：修复有问题的dump.rdb文件")])]),s._v(" "),a("li",[a("p",[s._v("redis-sentinel：Redis集群使用")])]),s._v(" "),a("li",[a("p",[s._v("redis-server：Redis服务器启动命令")])]),s._v(" "),a("li",[a("p",[s._v("redis-cli：客户端，操作入口")])])]),s._v(" "),a("h4",{attrs:{id:"前台启动-不推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前台启动-不推荐"}},[s._v("#")]),s._v(" 前台启动（不推荐）")]),s._v(" "),a("p",[s._v("前台启动，命令行窗口不能关闭，否则服务器停止")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/1.2_2.png",alt:"image-20210715161948205"}})]),s._v(" "),a("h4",{attrs:{id:"后台启动-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后台启动-推荐"}},[s._v("#")]),s._v(" 后台启动（  推荐  ）")]),s._v(" "),a("blockquote",[a("p",[s._v("备份  redis.  conf")])]),s._v(" "),a("p",[s._v("拷贝一份redis.conf到其他目录")]),s._v(" "),a("p",[s._v("cp  /opt/redis-3.2.5/redis.conf  /myredis")]),s._v(" "),a("blockquote",[a("p",[s._v("后台启动设置  daemonize no  改成  yes")])]),s._v(" "),a("p",[s._v("修改redis.conf(128行)文件将里面的daemonize no 改成 yes，让服务在后台启动")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis  启动")])]),s._v(" "),a("p",[s._v("redis-server/myredis/redis.conf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("用客户端访问：  redis-cli")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单端口")]),s._v("\nredis-cli\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多个端口")]),s._v("\nredis-cli   -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("测试验证：   ping")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\nPONG\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("Redis  关闭")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单实例关闭")]),s._v("\nredis-cli "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以进入终端后再关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 多实例关闭，指定端口关闭")]),s._v("\nredis-cli -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_1-3-redis介绍相关知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-redis介绍相关知识"}},[s._v("#")]),s._v(" 1.3 Redis介绍相关知识")]),s._v(" "),a("blockquote",[a("p",[s._v("默认16个数据库")])]),s._v(" "),a("p",[s._v("类似数组下标从0开始，初始默认使用0号库使用命令 "),a("code",[s._v("select <dbid>")]),s._v("来切换数据库。如: select 8 统一密码管理，所有库同样密码。")]),s._v(" "),a("p",[a("code",[s._v("dbsize")]),s._v("查看当前数据库的key的数量")]),s._v(" "),a("p",[a("code",[s._v("flushdb")]),s._v("清空当前库flushall通杀全部库")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis是单线程+多路IO复用技术")])]),s._v(" "),a("p",[s._v("多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）")]),s._v(" "),a("p",[s._v("串行  vs  多线程+锁（memcached） vs  单线程+多路IO复用(Redis)")]),s._v(" "),a("p",[s._v("（与Memcache三点不同: 支持多数据类型，支持持久化，单线程+多路IO复用）")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/1.3_1.png",alt:"image-20210715162204072"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_2-常用五大数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-常用五大数据类型"}},[s._v("#")]),s._v(" 2. 常用五大数据类型")]),s._v(" "),a("p",[s._v("哪里去获得redis常见数据类型操作命令http://www.redis.cn/commands.html")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"0"}},[a("li",[a("strong",[s._v("键 key")])]),s._v(" "),a("li",[a("strong",[s._v("字符串 string")])]),s._v(" "),a("li",[a("strong",[s._v("列表 list")])]),s._v(" "),a("li",[a("strong",[s._v("集合 set")])]),s._v(" "),a("li",[a("strong",[s._v("哈希 hash")])]),s._v(" "),a("li",[a("strong",[s._v("有序集合 Zset")])])])]),s._v(" "),a("h3",{attrs:{id:"_2-0-键-key-redis的最小单位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-键-key-redis的最小单位"}},[s._v("#")]),s._v(" 2.0 键  key -  Redis的最小单位")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("keys *       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前库所有key   (匹配：keys *1)")]),s._v("\nexists key   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断某个key是否存在")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" key     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看你的key是什么类型")]),s._v("\ndel key      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定的key数据")]),s._v("\nunlink key   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据value选择非阻塞删除")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作。")]),s._v("\nexpire key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10秒钟：为给定的key设置过期时间")]),s._v("\nttl key      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看还有多少秒过期，-1表示永不过期，-2表示已过期")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 命令切换数据库")]),s._v("\ndbsize       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前数据库的key的数量")]),s._v("\nflushdb      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空当前库")]),s._v("\nflushall     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通杀全部库")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_2-1-字符串-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-字符串-string"}},[s._v("#")]),s._v(" 2.1  字符串  String")]),s._v(" "),a("p",[s._v("String是Redis最基本的类型，可以理解成与Memcached一模一样的类型，一个key对应一个value。")]),s._v(" "),a("p",[s._v("String类型是二进制安全的。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。")]),s._v(" "),a("p",[s._v("String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M")]),s._v(" "),a("h4",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("EX seconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PX milliseconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("KEEPTTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("XX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加/更改键值对")]),s._v("\n\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NX：当数据库中key不存在时，可以将key-value添加数据库")]),s._v("\n\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# XX：当数据库中key存在时，可以将key-value添加数据库")]),s._v("\n\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# EX：key的超时秒数")]),s._v("\n\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PX：key的超时毫秒数，与EX互斥")]),s._v("\n\t\t\t\t\t\t\t\t \nget key          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询对应键值")]),s._v("\nappend key value "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将给定的<value> 追加到原值的末尾")]),s._v("\nstrlen key       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得值的长度")]),s._v("\nsetnx key value  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有在 key 不存在时才设置 key 的值")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只能对数字值操作")]),s._v("\nincr key         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 key 中储存的数字值增1，如果为空，新增值为1")]),s._v("\ndecr key         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 key 中储存的数字值减1，如果为空，新增值为-1")]),s._v("\nincrby / decrby key 步长 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 key 中储存的数字值增减。自定义步长。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("原子性")])])]),s._v(" "),a("p",[s._v("所谓 原子 操作是指不会被线程调度机制打断的操作；这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。")]),s._v(" "),a("ol",[a("li",[s._v('在单线程中， 能够在单条指令中完成的操作都可以认为是"原子操作"，因为中断只能发生于指令之间。')]),s._v(" "),a("li",[s._v("在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。Redis单命令的原子性主要得益于Redis的单线程。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mset key value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时设置一个或多个 key-value对  ")]),s._v("\nmget key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \t\t\t\t\t\t   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时获取一个或多个 value  ")]),s._v("\nmsetnx key value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。")]),s._v("\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原子性，有一个失败则都失败 ")]),s._v("\n\ngetrange key start end \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得值的范围，类似java中的substring，左闭右闭 ")]),s._v("\nsetrange key offset value "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用 value 覆写 key 所储存的字符串值")]),s._v("\n\t\t\t\t\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 offset 开始(索引从0开始)。")]),s._v("\nsetex key seconds value   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置键值的同时，设置过期时间，单位秒。")]),s._v("\ngetset key value \t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以新换旧，设置了新值同时获得旧值。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"数据结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构"}},[s._v("#")]),s._v(" 数据结构")]),s._v(" "),a("p",[s._v("String的数据结构为"),a("code",[s._v("简单动态字符串")]),s._v("(Simple Dynamic String，缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.1_1.png",alt:"image-20210716153849299"}})]),s._v(" "),a("p",[s._v("如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。")]),s._v(" "),a("h3",{attrs:{id:"_2-2-列表-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-列表-list"}},[s._v("#")]),s._v(" 2.2 列表  List")]),s._v(" "),a("blockquote",[a("p",[s._v("单键多值")])]),s._v(" "),a("p",[s._v("Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。")]),s._v(" "),a("p",[s._v("它的底层实际是个双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.2_1.png",alt:"image-20210721113349394"}})]),s._v(" "),a("h4",{attrs:{id:"常用命令-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-2"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("lpush/rpush key element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从左边/右边插入一个或多个值。")]),s._v("\nlpop/rpop key  \t\t\t\t\t\t\t \t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从左边/右边吐出一个值。值在键在，值光键亡。")]),s._v("\nrpoplpush "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" destination \t\t\t\t  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列表右边吐出一个值，插到source列表左边。")]),s._v("\nlrange key start stop                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照索引下标获得元素(从左到右)")]),s._v("\nlrange mylist "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0:左边第一个，-1:右边第一个，（0 -1表示获取所有）")]),s._v("\n\nlindex key index                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照索引下标获得元素(从左到右)")]),s._v("\nllen key\t\t\t\t\t\t\t \t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得列表长度 ")]),s._v("\nlinsert key BEFORE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("AFTER pivot value  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 pivot 的前/后插入 value 插入值")]),s._v("\nlrem key count element                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从左边删除n个 element (从左到右)")]),s._v("\nlset key index element\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将列表key下标为 index 的值替换成 element")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"数据结构-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构-2"}},[s._v("#")]),s._v(" 数据结构")]),s._v(" "),a("p",[s._v("List的数据结构为"),a("code",[s._v("快速链表")]),s._v("quickList。")]),s._v(" "),a("p",[s._v("首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。")]),s._v(" "),a("p",[s._v("它将所有的元素紧挨着一起存储，分配的是一块连续的内存。当数据量比较多的时候才会改成quicklist。")]),s._v(" "),a("p",[s._v("因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.2_2.png",alt:"image-20210716160850305"}})]),s._v(" "),a("p",[s._v("Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。")]),s._v(" "),a("h3",{attrs:{id:"_2-3-集合-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-集合-set"}},[s._v("#")]),s._v(" 2.3 集合  Set")]),s._v(" "),a("p",[s._v("Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以 自动排重 的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。")]),s._v(" "),a("p",[s._v("Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的 复杂度都是O(1) 。")]),s._v(" "),a("p",[s._v("一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变")]),s._v(" "),a("h4",{attrs:{id:"常用命令-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-3"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("sadd key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个或多个 member 元素加入到集合 key 中")]),s._v("\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 已经存在的 member 元素将被忽略")]),s._v("\nsmembers key                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取出该集合的所有值。")]),s._v("\nsismember key member             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断集合<key>是否为含有该<value>值，有1，没有0")]),s._v("\nscard key \t\t\t\t\t\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回该集合的元素个数。")]),s._v("\nsrem key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除集合中的某个元素。")]),s._v("\nspop key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \t             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机从该集合中吐出一个值。 ")]),s._v("\nsrandmember key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机从该集合中取出n个值。不会从集合中删除 。")]),s._v("\nsmove "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" destination member  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把集合中一个值从一个集合移动到另一个集合")]),s._v("\nsinter key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回两个集合的交集元素。")]),s._v("\nsunion key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\t\t\t\t\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回两个集合的并集元素。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sdiff")]),s._v(" key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回两个集合的 差集 元素(key1中的，不包含key2中的)")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"数据结构-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构-3"}},[s._v("#")]),s._v(" 数据结构")]),s._v(" "),a("p",[s._v("Set数据结构是dict字典，字典是用哈希表实现的。")]),s._v(" "),a("p",[s._v("Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个Object对象。Redis的set结构也是一样，它的内部也使用hash结构，所有的value都指向同一个内部值。")]),s._v(" "),a("h3",{attrs:{id:"_2-4-哈希-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-哈希-hash"}},[s._v("#")]),s._v(" 2.4 哈希  Hash")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis hash 是一个键值对集合。")])]),s._v(" "),a("p",[s._v("Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。类似Java里面的"),a("code",[s._v("Map<String,Object>")])]),s._v(" "),a("p",[s._v("用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，如果用普通的key/value结构来存储，主要有以下2种存储方式：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("方法")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("效果")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.4_1.png",alt:"截屏2021-07-16 16.57.59"}}),a("br"),s._v("user : {id = 1, name = zhangsan, age = 20}")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("每次修改用户的某个属性需要先反序列化改好后再序列化回去。"),a("br"),s._v("开销较大。")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.4_2.png",alt:"img"}}),a("br"),s._v("user:id  1"),a("br"),s._v("user:name zhangsan"),a("br"),s._v("user:age 20")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("用户ID数据冗余")])])])]),s._v(" "),a("p",[s._v("通过Redis hash类型就可以实现第3种存储方式：通过 key(用户  ID) + field(  属性标签  )   就可以操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.4_3.png",alt:"截屏2021-07-16 16.59.34"}})]),s._v(" "),a("h4",{attrs:{id:"常用命令-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-4"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("hset key field value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给<key>集合中的  <field>键赋值<value>")]),s._v("\nhget key field                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集合<field>取出 value ")]),s._v("\nhmset key field value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量设置hash的值")]),s._v("\nhexists key field                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看哈希表 key 中，给定域 field 是否存在, 1=true")]),s._v("\nhkeys key                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出该hash集合的所有field")]),s._v("\nhvals key                                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出该hash集合的所有value")]),s._v("\nhincrby key field increment              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为哈希表 key 中的域 field 的值加上增量increment")]),s._v("\nhsetnx key field value                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将哈希表 key 中的域 field 的值设置为 value，当且仅当域 field 不存在时")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"数据结构-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构-4"}},[s._v("#")]),s._v(" 数据结构")]),s._v(" "),a("p",[s._v("Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）。当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable。")]),s._v(" "),a("h3",{attrs:{id:"_2-5-有序集合-zset-sorted-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-有序集合-zset-sorted-set"}},[s._v("#")]),s._v(" 2.5 有序集合  Zset(sorted set)")]),s._v(" "),a("p",[s._v("Redis有序集合zset与普通集合set非常相似，是一个没有重复元素的字符串集合。")]),s._v(" "),a("p",[s._v("不同之处是有序集合的每个成员都关联了一个 评分（score)，这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了 。")]),s._v(" "),a("p",[s._v("因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。")]),s._v(" "),a("p",[s._v("访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。")]),s._v(" "),a("h4",{attrs:{id:"常用命令-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令-5"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个或多个 member 元素及其 score 值加入到有序集 key 当中。")]),s._v("\nzadd key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("XX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("CH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INCR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" score member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("score member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回有序集key中，下标在[start,stop]之间的元素, 带WITHSCORES，可以让分数一起和值返回到结果集。")]),s._v("\nzrange key start stop "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有序集成员按 score 值递增(从小到大)次序排列。 ")]),s._v("\nzrangebyscore key min max "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("LIMIT offset count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同上，改为从大到小排列。 ")]),s._v("\nzrevrangebyscore key max min "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("LIMIT offset count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\nzincrby key increment member           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为元素的score加上增量")]),s._v("\nzrem key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除该集合下，指定值的元素 ")]),s._v("\nzcount key min max                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计该集合，分数区间内的元素个数 ")]),s._v("\nzrank key member                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回该值在集合中的排名，从0开始。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("案例：如何利用zset实现一个文章访问量的排行榜？")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.5_1.png",alt:"截屏2021-07-19 15.12.03"}})]),s._v(" "),a("h4",{attrs:{id:"数据结构-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据结构-5"}},[s._v("#")]),s._v(" 数据结构")]),s._v(" "),a("p",[s._v("SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构"),a("code",[s._v("Map<String, Double>")]),s._v("，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。")]),s._v(" "),a("p",[s._v("zset底层使用了两个数据结构")]),s._v(" "),a("ol",[a("li",[s._v("hash，hash的作用就是关联元素value和权重score，保障元素value的唯一性，可以通过元素value找到相应的score值。")]),s._v(" "),a("li",[s._v("跳跃表，跳跃表的目的在于给元素value排序，根据score的范围获取元素列表。")])]),s._v(" "),a("h5",{attrs:{id:"跳跃表-跳表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表-跳表"}},[s._v("#")]),s._v(" "),a("strong",[s._v("跳跃表（跳表）")])]),s._v(" "),a("p",[s._v("有序集合在生活中比较常见，例如根据成绩对学生排名，根据得分对玩家排名等。对于有序集合的底层实现，可以用数组、平衡树、链表等。数组不便元素的插入、删除；平衡树或红黑树虽然效率高但结构复杂；链表查询需要遍历所有效率低。Redis采用的是跳跃表。跳跃表效率堪比红黑树，实现远比红黑树简单。")]),s._v(" "),a("blockquote",[a("p",[s._v("案例")])]),s._v(" "),a("p",[s._v("对比有序链表和跳跃表，从链表中查询出51")]),s._v(" "),a("p",[a("em",[a("strong",[s._v("有序链表：")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.5_2.png",alt:"image-20210719151352022"}})]),s._v(" "),a("p",[s._v("要查找值为51的元素，需要从第一个元素开始依次查找、比较才能找到。共需要6次比较。")]),s._v(" "),a("p",[a("em",[a("strong",[s._v("跳跃表：")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/2.5_3.png",alt:"image-20210719151356429"}})]),s._v(" "),a("p",[s._v("从第2层开始，1节点比51节点小，向后比较。21节点比51节点小，继续向后比较，后面就是NULL了，所以从21节点向下到第1层")]),s._v(" "),a("p",[s._v("在第1层，41节点比51节点小，继续向后，61节点比51节点大，所以从41向下")]),s._v(" "),a("p",[s._v("在第0层，51节点为要查找的节点，节点被找到，共查找4次。")]),s._v(" "),a("p",[s._v("从此可以看出跳跃表比有序链表效率要高")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-redis配置文件介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-redis配置文件介绍"}},[s._v("#")]),s._v(" 3. Redis配置文件介绍")]),s._v(" "),a("blockquote",[a("p",[s._v("自定义目录："),a("code",[s._v("/usr/local/etc")])])]),s._v(" "),a("h3",{attrs:{id:"_3-1-units-单位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-units-单位"}},[s._v("#")]),s._v(" 3.1 Units  单位")]),s._v(" "),a("p",[s._v("配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit，·大小写不敏感")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis configuration file example.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note that in order to read the configuration file, Redis must be")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# started with the file path as first argument:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./redis-server /path/to/redis.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note on units: when memory size is needed, it is possible to specify")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# it in the usual form of 1k 5GB 4M and so forth:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1k => 1000 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1kb => 1024 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1m => 1000000 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1mb => 1024*1024 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1g => 1000000000 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1gb => 1024*1024*1024 bytes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# units are case insensitive so 1GB 1Gb 1gB are all the same.")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"_3-2-includes-包含"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-includes-包含"}},[s._v("#")]),s._v(" 3.2 INCLUDES  包含")]),s._v(" "),a("p",[s._v("类似jsp中的include，多实例的情况可以把公用的配置文件提取出来")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################## INCLUDES ###################################")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Include one or more other config files here.  This is useful if you")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# have a standard template that goes to all Redis servers but also need")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to customize a few per-server settings.  Include files can include")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# other files, so use this wisely.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Note that option "include" won\'t be rewritten by command "CONFIG REWRITE"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# from admin or Redis Sentinel. Since Redis always uses the last processed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# line as value of a configuration directive, you'd better put includes")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# at the beginning of this file to avoid overwriting config change at runtime.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If instead you are interested in using includes to override configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# options, it is better to use include as the last line.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# include /path/to/local.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# include /path/to/other.conf")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h3",{attrs:{id:"_3-3-网络相关配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-网络相关配置"}},[s._v("#")]),s._v(" 3.3 网络相关配置")]),s._v(" "),a("h4",{attrs:{id:"_3-3-1-bind"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-bind"}},[s._v("#")]),s._v(" 3.3.1 bind")]),s._v(" "),a("p",[s._v("默认情况bind=127.0.0.1只能接受本机的访问请求，不写的情况下，无限制接受任何ip地址的访问")]),s._v(" "),a("p",[s._v("生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################## NETWORK #####################################")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# By default, if no "bind" configuration directive is specified, Redis listens')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for connections from all available network interfaces on the host machine.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# It is possible to listen to just one or multiple selected interfaces using")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# the "bind" configuration directive, followed by one or more IP addresses.')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Examples:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bind 192.168.1.100 10.0.0.1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bind 127.0.0.1 ::1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# internet, binding to all the interfaces is dangerous and will expose the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# instance to everybody on the internet. So by default we uncomment the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# following bind directive, that will force Redis to listen only on the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IPv4 loopback interface address (this means Redis will only be able to")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accept client connections from the same host that it is running on).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JUST COMMENT OUT THE FOLLOWING LINE.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 ::1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h4",{attrs:{id:"_3-3-2-protected-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-protected-mode"}},[s._v("#")]),s._v(" 3.3.2 protected-mode")]),s._v(" "),a("p",[s._v("如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Protected mode is a layer of security protection, in order to avoid that")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis instances left open on the internet are accessed and exploited.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# When protected mode is on and if:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1) The server is not binding explicitly to a set of addresses using the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "bind" directive.')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2) No password is configured.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The server only accepts connections from clients connecting from the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sockets.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# By default protected mode is enabled. You should disable it only if")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# you are sure you want clients from other hosts to connect to Redis")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# even if no authentication is configured, nor a specific set of interfaces")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# are explicitly listed using the "bind" directive.')]),s._v("\nprotected-mode "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h4",{attrs:{id:"_3-3-3-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-port"}},[s._v("#")]),s._v(" 3.3.3 port")]),s._v(" "),a("p",[s._v("端口号，默认 6379")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Accept connections on the specified port, default is 6379 (IANA #815344).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If port 0 is specified Redis will not listen on a TCP socket.")]),s._v("\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_3-3-4-tcp-backlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-tcp-backlog"}},[s._v("#")]),s._v(" 3.3.4 tcp-backlog")]),s._v(" "),a("p",[s._v("设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。")]),s._v(" "),a("p",[s._v("在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。")]),s._v(" "),a("p",[s._v("注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值（128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值来达到想要的效果")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP listen() backlog.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# In high requests-per-second environments you need a high backlog in order")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to avoid slow clients connection issues. Note that the Linux kernel")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# will silently truncate it to the value of /proc/sys/net/core/somaxconn so")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# make sure to raise both the value of somaxconn and tcp_max_syn_backlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# in order to get the desired effect.")]),s._v("\ntcp-backlog "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("511")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"_3-3-5-timeout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-5-timeout"}},[s._v("#")]),s._v(" 3.3.5 timeout")]),s._v(" "),a("p",[s._v("一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即永不关闭。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Close the connection after a client is idle for N seconds (0 to disable)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_3-3-6-tcp-keepalive"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-6-tcp-keepalive"}},[s._v("#")]),s._v(" 3.3.6 tcp-keepalive")]),s._v(" "),a("p",[s._v("对访问客户端的一种心跳检测，每个n秒检测一次。")]),s._v(" "),a("p",[s._v("单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP keepalive.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# of communication. This is useful for two reasons:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1) Detect dead peers.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2) Force network equipment in the middle to consider the connection to be")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    alive.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On Linux, the specified value (in seconds) is the period used to send ACKs.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note that to close the connection the double of the time is needed.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# On other kernels the period depends on the kernel configuration.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A reasonable value for this option is 300 seconds, which is the new")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis default starting with Redis 3.2.1.")]),s._v("\ntcp-keepalive "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"_3-4-general-通用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-general-通用"}},[s._v("#")]),s._v(" 3.4 GENERAL  通用")]),s._v(" "),a("h4",{attrs:{id:"_3-4-1-daemonize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-daemonize"}},[s._v("#")]),s._v(" 3.4.1 daemonize")]),s._v(" "),a("p",[s._v("是否为后台进程，设置为yes")]),s._v(" "),a("p",[s._v("守护进程，后台启动")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# By default Redis does not run as a daemon. Use 'yes' if you need it.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note that Redis will write a pid file in /usr/local/var/run/redis.pid when daemonized.")]),s._v("\ndaemonize no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_3-4-2-pidfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-pidfile"}},[s._v("#")]),s._v(" 3.4.2 pidfile")]),s._v(" "),a("p",[s._v("存放pid文件的位置，每个实例会产生一个不同的pid文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If a pid file is specified, Redis writes it where specified at startup")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and removes it at exit.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# When the server runs non daemonized, no pid file is created if none is")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# specified in the configuration. When the server is daemonized, the pid file")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# is used even if not specified, defaulting to "/usr/local/var/run/redis.pid".')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Creating a pid file is best effort: if Redis is not able to create it")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nothing bad happens, the server will start and run normally.")]),s._v("\npidfile /var/run/redis_6379.pid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"_3-4-3-loglevel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-loglevel"}},[s._v("#")]),s._v(" 3.4.3 loglevel")]),s._v(" "),a("p",[s._v("指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为 notice")]),s._v(" "),a("p",[s._v("四个级别根据使用阶段来选择，生产环境选择notice 或者warning")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the server verbosity level.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This can be one of:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# debug (a lot of information, useful for development/testing)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# verbose (many rarely useful info, but not a mess like the debug level)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# notice (moderately verbose, what you want in production probably)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# warning (only very important / critical messages are logged)")]),s._v("\nloglevel notice\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_3-4-4-logfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-4-logfile"}},[s._v("#")]),s._v(" 3.4.4 logfile")]),s._v(" "),a("p",[s._v("日志文件名称")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Specify the log file name. Also the empty string can be used to force")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis to log on the standard output. Note that if you use standard")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# output for logging but daemonize, logs will be sent to /dev/null")]),s._v("\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_3-4-5-databases-16"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-5-databases-16"}},[s._v("#")]),s._v(" 3.4.5 databases 16")]),s._v(" "),a("p",[s._v("设定库的数量 默认16，默认数据库为0，可以使用"),a("code",[s._v("SELECT <dbid>")]),s._v("命令在连接上指定数据库id")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the number of databases. The default database is DB 0, you can select")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a different one on a per-connection basis using SELECT <dbid> where")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dbid is a number between 0 and 'databases'-1")]),s._v("\ndatabases "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_3-5-security-安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-security-安全"}},[s._v("#")]),s._v(" 3.5 SECURITY  安全")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################## SECURITY ###################################")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Warning: since Redis is pretty fast, an outside user can try up to")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 million passwords per second against a modern box. This means that you")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# should use very strong passwords, otherwise they will be very easy to break.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note that because the password is really a shared secret between the client")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and the server, and should not be memorized by any human, the password")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# can be easily a long string from /dev/urandom or whatever, so by using a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# long and unguessable password no brute force attack will be possible.")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"_3-5-1-设置密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-1-设置密码"}},[s._v("#")]),s._v(" 3.5.1 设置密码")]),s._v(" "),a("p",[s._v("访问密码的查看、设置和取消")]),s._v(" "),a("p",[s._v("在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# IMPORTANT NOTE: starting with Redis 6 "requirepass" is just a compatibility')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# layer on top of the new ACL system. The option effect will be just setting")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the password for the default user. Clients will still authenticate using")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AUTH <password> as usually, or more explicitly with AUTH default <password>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if they follow the new protocol: both will work.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# requirepass foobared")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("永久设置，需要再配置文件中进行设置。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/3.5_1.png",alt:"image-20210719155509684"}})]),s._v(" "),a("h3",{attrs:{id:"_3-6-limits-限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-limits-限制"}},[s._v("#")]),s._v(" 3.6 LIMITS  限制")]),s._v(" "),a("h4",{attrs:{id:"_3-6-1-maxclients"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-1-maxclients"}},[s._v("#")]),s._v(" 3.6.1 maxclients")]),s._v(" "),a("ul",[a("li",[s._v("设置"),a("code",[s._v("redis")]),s._v("同时可以与多少个客户端进行连接。")]),s._v(" "),a("li",[s._v("默认情况下为10000个客户端。")]),s._v(" "),a("li",[s._v("如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("################################### CLIENTS ####################################")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the max number of connected clients at the same time. By default")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this limit is set to 10000 clients, however if the Redis server is not")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# able to configure the process file limit to allow for the specified limit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the max number of allowed clients is set to the current file limit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# minus 32 (as Redis reserves a few file descriptors for internal uses).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Once the limit is reached Redis will close all the new connections sending")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# an error 'max number of clients reached'.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IMPORTANT: When Redis Cluster is used, the max number of connections is also")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shared with the cluster bus: every node in the cluster will use two")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# connections, one incoming and another outgoing. It is important to size the")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limit accordingly in case of very large clusters.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# maxclients 10000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h4",{attrs:{id:"_3-6-2-maxmemory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-2-maxmemory"}},[s._v("#")]),s._v(" 3.6.2 maxmemory")]),s._v(" "),a("ul",[a("li",[s._v("建议 必须设置 ，否则，将内存占满，造成服务器宕机")]),s._v(" "),a("li",[s._v("设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过maxmemory-policy来指定。")]),s._v(" "),a("li",[s._v("如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。")]),s._v(" "),a("li",[s._v("但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("############################## MEMORY MANAGEMENT ################################")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set a memory usage limit to the specified amount of bytes.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# When the memory limit is reached Redis will try to remove keys")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# according to the eviction policy selected (see maxmemory-policy).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If Redis can't remove keys according to the policy, or if the policy is")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set to 'noeviction', Redis will start to reply with errors to commands")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# that would use more memory, like SET, LPUSH, and so on, and will continue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to reply to read-only commands like GET.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This option is usually useful when using Redis as an LRU or LFU cache, or to")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set a hard memory limit for an instance (using the 'noeviction' policy).")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WARNING: If you have replicas attached to an instance with maxmemory on,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the size of the output buffers needed to feed the replicas are subtracted")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# from the used memory count, so that network problems / resyncs will")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# not trigger a loop where keys are evicted, and in turn the output")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# buffer of replicas is full with DELs of keys evicted triggering the deletion")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# of more keys, and so forth until the database is completely emptied.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# In short... if you have replicas attached it is suggested that you set a lower")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# limit for maxmemory so that there is some free RAM on the system for replica")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# output buffers (but this is not needed if the policy is 'noeviction').")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# maxmemory <bytes>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"_3-6-3-maxmemory-policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-3-maxmemory-policy"}},[s._v("#")]),s._v(" 3.6.3 maxmemory-policy")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("volatile-lru")]),s._v("：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）")]),s._v(" "),a("li",[a("code",[s._v("allkeys-lru")]),s._v("：在所有集合key中，使用LRU算法移除key")]),s._v(" "),a("li",[a("code",[s._v("volatile-random")]),s._v("：在过期集合中移除随机的key，只对设置了过期时间的键")]),s._v(" "),a("li",[a("code",[s._v("allkeys-random")]),s._v("：在所有集合key中，移除随机的key")]),s._v(" "),a("li",[a("code",[s._v("volatile-ttl")]),s._v("：移除那些TTL值最小的key，即那些最近要过期的key")]),s._v(" "),a("li",[a("code",[s._v("noeviction")]),s._v("：不进行移除。针对写操作，只是返回错误信息")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MAXMEMORY POLICY: how Redis will select what to remove when maxmemory")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# is reached. You can select one from the following behaviors:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# volatile-lru -> Evict using approximated LRU, only keys with an expire set.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allkeys-lru -> Evict any key using approximated LRU.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# volatile-lfu -> Evict using approximated LFU, only keys with an expire set.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allkeys-lfu -> Evict any key using approximated LFU.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# volatile-random -> Remove a random key having an expire set.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# allkeys-random -> Remove a random key, any key.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# volatile-ttl -> Remove the key with the nearest expire time (minor TTL)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# noeviction -> Don't evict anything, just return an error on write operations.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LRU means Least Recently Used")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LFU means Least Frequently Used")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Both LRU, LFU and volatile-ttl are implemented using approximated")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# randomized algorithms.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note: with any of the above policies, Redis will return an error on write")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       operations, when there are no suitable keys for eviction.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       At the date of writing these commands are: set setnx setex append")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       getset mset msetnx exec sort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The default is:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# maxmemory-policy noeviction")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h4",{attrs:{id:"_3-6-4-maxmemory-samples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-4-maxmemory-samples"}},[s._v("#")]),s._v(" 3.6.4 maxmemory-samples")]),s._v(" "),a("ul",[a("li",[s._v("设置样本数量，LRU算法和最小TTL算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis默认会检查这么多个key并选择其中LRU的那个。")]),s._v(" "),a("li",[s._v("一般设置3到7的数字，数值越小样本越不准确，但性能消耗越小。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# algorithms (in order to save memory), so you can tune it for speed or")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# accuracy. By default Redis will check five keys and pick the one that was")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# used least recently, you can change the sample size using the following")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# configuration directive.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The default of 5 produces good enough results. 10 Approximates very closely")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# true LRU but costs more CPU. 3 is faster but not very accurate.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# maxmemory-samples 5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_4-redis的发布和订阅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-redis的发布和订阅"}},[s._v("#")]),s._v(" 4. Redis的发布和订阅")]),s._v(" "),a("p",[s._v("Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。")]),s._v(" "),a("p",[s._v("Redis 客户端可以订阅任意数量的频道。")]),s._v(" "),a("h3",{attrs:{id:"_4-1-redis的发布和订阅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-redis的发布和订阅"}},[s._v("#")]),s._v(" 4.1 Redis的发布和订阅")]),s._v(" "),a("ol",[a("li",[s._v("客户端可以订阅频道如下图")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/4.1_1.png",alt:"image-20210719160315110"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("当给这个频道发布消息后，消息就会发送给订阅的客户端")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/4.1_2.png",alt:"image-20210719160324561"}})]),s._v(" "),a("h3",{attrs:{id:"_4-2-发布订阅命令行实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-发布订阅命令行实现"}},[s._v("#")]),s._v(" 4.2 发布订阅命令行实现")]),s._v(" "),a("ol",[a("li",[s._v("打开一个客户端订阅"),a("code",[s._v("channel1")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" subscribe channel1\nReading messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("press Ctrl-C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subscribe"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("打开另一个客户端，给"),a("code",[s._v("channel1")]),s._v("发布消息"),a("code",[s._v("helloworld")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" publish channel1 helloworld\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回的1是订阅者数量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("打开第一个客户端可以看到发送的消息")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" subscribe channel1\nReading messages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("press Ctrl-C to quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subscribe"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"channel1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"helloworld"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("注：发布的消息没有持久化，如果在订阅的客户端收不到"),a("code",[s._v("helloworld")]),s._v("，只能收到订阅后发布的消息")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_5-redis6-新数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-redis6-新数据类型"}},[s._v("#")]),s._v(" 5. Redis6 新数据类型")]),s._v(" "),a("h3",{attrs:{id:"_5-1-bitmaps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-bitmaps"}},[s._v("#")]),s._v(" 5.1 Bitmaps")]),s._v(" "),a("p",[s._v("现代计算机用"),a("code",[s._v("二进制（位）")]),s._v("作为信息的基础单位，"),a("code",[s._v("1个字节")]),s._v("等于"),a("code",[s._v("8位")]),s._v("， 例如"),a("code",[s._v("abc")]),s._v("字符串是由"),a("code",[s._v("3")]),s._v("个字节组成， 但实际在计算机存储时将其用二进制表示， "),a("code",[s._v("abc")]),s._v("分别对应的ASCII码分别是"),a("code",[s._v("97")]),s._v("、 "),a("code",[s._v("98")]),s._v("、"),a("code",[s._v("99")]),s._v("， 对应的二进制分别是"),a("code",[s._v("01100001")]),s._v("、"),a("code",[s._v("01100010")]),s._v("和"),a("code",[s._v("01100011")]),s._v("，如下图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/5.1_1.png",alt:"image-20210719160931191"}})]),s._v(" "),a("p",[s._v("合理地使用操作位能够有效地提高内存使用率和开发效率。")]),s._v(" "),a("p",[s._v("Redis提供了"),a("code",[s._v("Bitmaps")]),s._v("可以实现对位的操作：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("Bitmaps")]),s._v("本身不是一种数据类型， 实际上它就是字符串， 但是它可以对字符串的位进行操作。")]),s._v(" "),a("li",[a("code",[s._v("Bitmaps")]),s._v("单独提供了一套命令， 所以在Redis中使用"),a("code",[s._v("Bitmaps")]),s._v("和使用字符串的方法不太相同。 可以把"),a("code",[s._v("Bitmaps")]),s._v("想象成一个以位为单位的数组， 数组的每个单元只能存储"),a("code",[s._v("0")]),s._v("和"),a("code",[s._v("1")]),s._v("， 数组的下标在"),a("code",[s._v("Bitmaps")]),s._v("中叫做"),a("code",[s._v("偏移量")]),s._v("。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/5.1_2.png",alt:"image-20210719161015911"}})]),s._v(" "),a("h4",{attrs:{id:"_5-1-1-commands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-commands"}},[s._v("#")]),s._v(" 5.1.1 Commands")]),s._v(" "),a("h5",{attrs:{id:"_1-setbit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-setbit"}},[s._v("#")]),s._v(" 1. setbit")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("setbit key offset value   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置Bitmaps中某个偏移量的值（0或1）")]),s._v("\n                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# offset:偏移量从0开始")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("e.g.1")])]),s._v(" "),a("p",[s._v("每个独立用户是否访问过网站存放在"),a("code",[s._v("Bitmaps")]),s._v("中， 将访问的用户记做"),a("code",[s._v("1")]),s._v("， 没有访问的用户记做"),a("code",[s._v("0")]),s._v("， 用"),a("code",[s._v("偏移量")]),s._v("作为用户的id。")]),s._v(" "),a("p",[s._v("设置键的第"),a("code",[s._v("offset")]),s._v("个位的值（从0算起） ， 假设现在有20个用户，"),a("code",[s._v("userid=1")]),s._v("，"),a("code",[s._v("6")]),s._v("， "),a("code",[s._v("11")]),s._v("， "),a("code",[s._v("15")]),s._v("， "),a("code",[s._v("19")]),s._v("的用户对网站进行了访问， 那么当前"),a("code",[s._v("Bitmaps")]),s._v("初始化结果如图")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/5.1_3.png",alt:"image-20210719161403225"}})]),s._v(" "),a("p",[a("code",[s._v("unique:users:20201106")]),s._v("代表"),a("code",[s._v("2020-11-06")]),s._v("这天的独立访问用户的"),a("code",[s._v("Bitmaps")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("⚠️注意")])]),s._v(" "),a("p",[s._v("很多应用的用户id以一个指定数字（例如"),a("code",[s._v("10000")]),s._v("） 开头， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， 通常的做法是每次做setbit操作时将用户id减去这个指定数字。")]),s._v(" "),a("p",[s._v("在第一次初始化"),a("code",[s._v("Bitmaps")]),s._v("时， 假如偏移量非常大， 那么整个初始化过程执行会比较慢， 可能会造成Redis的阻塞。")]),s._v(" "),a("h5",{attrs:{id:"_2-getbit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-getbit"}},[s._v("#")]),s._v(" 2. getbit")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("getbit key offset "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取Bitmaps中某个偏移量的值")]),s._v("\n                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取键的第offset位的值（从0开始算）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("e.g.2")])]),s._v(" "),a("p",[s._v("获取"),a("code",[s._v("id=8")]),s._v("的用户是否在"),a("code",[s._v("2020-11-06")]),s._v("这天访问过， 返回"),a("code",[s._v("0")]),s._v("说明没有访问过：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("getbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" getbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" getbit unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("注：因为"),a("code",[s._v("100")]),s._v("根本不存在，所以也是返回"),a("code",[s._v("0")])]),s._v(" "),a("h5",{attrs:{id:"_3-bitcount"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-bitcount"}},[s._v("#")]),s._v(" 3. bitcount")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bitcount key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start end"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计字符串从start字节到end字节比特值为1的数量")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("统计"),a("code",[s._v("key")]),s._v(" 被设置为"),a("code",[s._v("1")]),s._v("的"),a("code",[s._v("bit")]),s._v("数。一般情况下，给定的整个"),a("code",[s._v("key")]),s._v("都会被进行计数，通过指定额外的 "),a("code",[s._v("[start,end]")]),s._v("，可以让计数只在特定的位上进行。")]),s._v(" "),a("p",[a("code",[s._v("start")]),s._v("和"),a("code",[s._v("end")]),s._v(" 参数的设置，都可以使用负数值：比如 "),a("code",[s._v("-1")]),s._v("表示最后一个位，而"),a("code",[s._v("-2")]),s._v("表示倒数第二个位，"),a("code",[s._v("start")]),s._v("、"),a("code",[s._v("end")]),s._v(" 是指bit组的字节的下标数。")]),s._v(" "),a("blockquote",[a("p",[s._v("e.g.1 计算"),a("code",[s._v("2020-11-06")]),s._v("这天的独立访问用户数量")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount unique:users:20201106\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("start")]),s._v("和"),a("code",[s._v("end")]),s._v("代表起始和结束字节数， 下面操作计算用户"),a("code",[s._v("id")]),s._v("在第"),a("code",[s._v("1")]),s._v("个字节到第"),a("code",[s._v("3")]),s._v("个字节之间的独立访问用户数， 对应的用户id是"),a("code",[s._v("11")]),s._v("， "),a("code",[s._v("15")]),s._v("， "),a("code",[s._v("19")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount unique:users:20201106 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("e.g.2 K1 【01000001 01000000  00000000 00100001】，对应字节下标【0，1，2，3】")]),s._v(" "),a("p",[s._v("注意：redis的setbit设置或清除的是bit位置，而bitcount计算的是byte位置。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4byte = 32bit，及")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下标 1 7 9 26 31 为1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" setbit K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bitcount单位为byte")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount K1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计下标1、2字节组中bit=1的个数，即01000000  00000000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计下标1、2字节组中bit=1的个数，即01000000  00000000 00100001")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount K1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计下标0到下标倒数第2，字节组中bit=1的个数，即01000001  01000000  00000000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"_4-bitop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-bitop"}},[s._v("#")]),s._v(" 4. bitop")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("bitop "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("and"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("or"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("not"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" destkey key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("bitop")]),s._v("是一个复合操作， 它可以做多个"),a("code",[s._v("Bitmaps")]),s._v("的"),a("code",[s._v("and")]),s._v("（交集）、 "),a("code",[s._v("or")]),s._v("（并集）、 "),a("code",[s._v("not")]),s._v("（非）、"),a("code",[s._v("xor")]),s._v("（异或） 操作并将结果保存在"),a("code",[s._v("destkey")]),s._v("中。")]),s._v(" "),a("blockquote",[a("p",[s._v("e.g.1 计算出两天都访问过网站的用户数量")])]),s._v(" "),a("p",[a("code",[s._v("2020-11-04")]),s._v(" 日访问网站的"),a("code",[s._v("userid=1,2,5,9")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("setbit unique:users:20201104 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201104 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201104 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201104 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("code",[s._v("2020-11-03")]),s._v(" 日访问网站的"),a("code",[s._v("userid=0,1,4,9")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("setbit unique:users:20201103 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201103 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201103 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nsetbit unique:users:20201103 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("计算出两天都访问过网站的用户数量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitop and unique:users:and:20201104_03 unique:users:20201103 unique:users:20201104\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/5.1_4.png",alt:"截屏2021-07-20 11.09.59"}})]),s._v(" "),a("p",[s._v("计算出任意一天都访问过网站的用户数量（例如月活跃就是类似这种） ，可以使用"),a("code",[s._v("or")]),s._v("求并集")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitop or unique:users:or:20201104_03 unique:users:20201103 unique:users:20201104\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" bitcount unique:users:or:20201104_03\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_5-1-2-bitmaps与set对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-bitmaps与set对比"}},[s._v("#")]),s._v(" 5.1.2 Bitmaps与Set对比")]),s._v(" "),a("p",[s._v("假设网站有1亿用户， 每天独立访问的用户有5千万， 如果每天用集合类型和Bitmaps分别存储活跃用户可以得到表")]),s._v(" "),a("blockquote",[a("p",[s._v("Set和Bitmaps存储一天活跃用户对比")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("数据类型")]),s._v(" "),a("th",[s._v("每个用户id占用空间")]),s._v(" "),a("th",[s._v("需要存储的用户量")]),s._v(" "),a("th",[s._v("全部内存量")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("集合类型")]),s._v(" "),a("td",[s._v("64位")]),s._v(" "),a("td",[s._v("50000000")]),s._v(" "),a("td",[s._v("64位*50000000 = 400MB")])]),s._v(" "),a("tr",[a("td",[s._v("Bitmaps")]),s._v(" "),a("td",[s._v("1位")]),s._v(" "),a("td",[s._v("100000000")]),s._v(" "),a("td",[s._v("1位*100000000 = 12.5MB")])])])]),s._v(" "),a("p",[s._v("很明显， 这种情况下使用Bitmaps能节省很多的内存空间， 尤其是随着时间推移节省的内存还是非常可观的")]),s._v(" "),a("blockquote",[a("p",[s._v("set和Bitmaps存储独立用户空间对比")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("数据类型")]),s._v(" "),a("th",[s._v("一天")]),s._v(" "),a("th",[s._v("一个月")]),s._v(" "),a("th",[s._v("一年")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("集合类型")]),s._v(" "),a("td",[s._v("400MB")]),s._v(" "),a("td",[s._v("12GB")]),s._v(" "),a("td",[s._v("144GB")])]),s._v(" "),a("tr",[a("td",[s._v("Bitmaps")]),s._v(" "),a("td",[s._v("12.5MB")]),s._v(" "),a("td",[s._v("375MB")]),s._v(" "),a("td",[s._v("4.5GB")])])])]),s._v(" "),a("p",[s._v("但Bitmaps并不是万金油， 假如该网站每天的独立访问用户很少， 例如只有10万（大量的僵尸用户） ， 那么两者的对比如下表所示， 很显然， 这时候使用Bitmaps就不太合适了， 因为基本上大部分位都是0。")]),s._v(" "),a("blockquote",[a("p",[s._v("set和Bitmaps存储一天活跃用户对比（独立用户比较少）")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("数据类型")]),s._v(" "),a("th",[s._v("每个userid占用空间")]),s._v(" "),a("th",[s._v("需要存储的用户量")]),s._v(" "),a("th",[s._v("全部内存量")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("集合类型")]),s._v(" "),a("td",[s._v("64位")]),s._v(" "),a("td",[s._v("100000")]),s._v(" "),a("td",[s._v("64位*100000 = 800KB")])]),s._v(" "),a("tr",[a("td",[s._v("Bitmaps")]),s._v(" "),a("td",[s._v("1位")]),s._v(" "),a("td",[s._v("100000000")]),s._v(" "),a("td",[s._v("1位*100000000 = 12.5MB")])])])]),s._v(" "),a("h3",{attrs:{id:"_5-2-hyperloglog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-hyperloglog"}},[s._v("#")]),s._v(" 5.2 HyperLogLog")]),s._v(" "),a("p",[s._v("在工作当中，我们经常会遇到与统计相关的功能需求，比如统计网站PV（PageView页面访问量）,可以使用Redis的"),a("code",[s._v("incr")]),s._v("、"),a("code",[s._v("incrby")]),s._v("轻松实现。")]),s._v(" "),a("p",[s._v("但像UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题如何解决？这种求集合中不重复元素个数的问题称为"),a("code",[s._v("基数问题")]),s._v("。")]),s._v(" "),a("p",[s._v("解决基数问题有很多种方案：")]),s._v(" "),a("ol",[a("li",[s._v("数据存储在MySQL表中，使用"),a("code",[s._v("distinct count")]),s._v("计算不重复个数")]),s._v(" "),a("li",[s._v("使用Redis提供的"),a("code",[s._v("hash")]),s._v("、"),a("code",[s._v("set")]),s._v("、"),a("code",[s._v("bitmaps")]),s._v("等数据结构来处理")])]),s._v(" "),a("p",[s._v("以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。能否能够降低一定的精度来平衡存储空间？于是Redis推出了"),a("code",[s._v("HyperLogLog")])]),s._v(" "),a("p",[s._v("Redis HyperLogLog 是用来做"),a("code",[s._v("基数统计")]),s._v("的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。")]),s._v(" "),a("p",[s._v("在 Redis 里面，每个 HyperLogLog 键只需要花费"),a("code",[s._v("12 KB")]),s._v("内存，就可以计算接近"),a("code",[s._v("2^64")]),s._v("个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。")]),s._v(" "),a("p",[s._v("但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。")]),s._v(" "),a("blockquote",[a("p",[s._v("什么是基数?")])]),s._v(" "),a("p",[s._v("比如数据集"),a("code",[s._v("{1, 3, 5, 7, 5, 7, 8}")]),s._v("， 那么这个数据集的基数集为"),a("code",[s._v("{1, 3, 5 ,7, 8}")]),s._v(", 基数(不重复元素)为"),a("code",[s._v("5")]),s._v("。 基数估计就是在误差可接受的范围内，快速计算基数。")]),s._v(" "),a("h4",{attrs:{id:"_1-pfadd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-pfadd"}},[s._v("#")]),s._v(" 1. pfadd")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pfadd key element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("element "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加指定元素到 HyperLogLog 中 ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("​\t将所有元素添加到指定HyperLogLog数据结构中。如果执行命令后HLL估计的近似基数发生变化，则返回1，否则返回0。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfadd hll1 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfadd hll1 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfadd hll1 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_2-pfcount"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-pfcount"}},[s._v("#")]),s._v(" 2. pfcount")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pfcount key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 计算HLL的近似基数，可以计算多个HLL")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如用HLL存储每天的UV，计算一周的UV可以使用7天的UV合并计算即可")]),s._v("\n                      \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfcount hll1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfadd hll2 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfadd hll2 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfcount hll1 hll2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_3-pfmerge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-pfmerge"}},[s._v("#")]),s._v(" 3. pfmerge")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pfmerge destkey sourcekey "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sourcekey "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个或多个HLL合并后的结果存储在另一个HLL中，")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如每月活跃用户可以使用每天的活跃用户来合并计算可得")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfmerge hll3 hll1 hll2\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" pfcount hll3\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("                                         \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_5-3-geospatial"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-geospatial"}},[s._v("#")]),s._v(" 5.3 Geospatial")]),s._v(" "),a("p",[s._v("Redis "),a("code",[s._v("3.2")]),s._v("中增加了对"),a("code",[s._v("GEO")]),s._v("类型的支持。GEO，Geographic，地理信息的缩写。该类型，就是元素的"),a("code",[s._v("2维")]),s._v("坐标，在地图上就是经纬度。redis基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作。")]),s._v(" "),a("h4",{attrs:{id:"_1-geoadd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-geoadd"}},[s._v("#")]),s._v(" 1. geoadd")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加地理位置（经度，纬度，名称）")]),s._v("\ngeoadd key longitude latitude member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("longitude latitude member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("两极无法直接添加，一般会下载城市数据，直接通过 Java 程序一次性导入。")]),s._v(" "),a("p",[s._v("有效的经度从"),a("code",[s._v("-180")]),s._v(" 度到 "),a("code",[s._v("180")]),s._v("度。有效的纬度从 "),a("code",[s._v("-85.05112878")]),s._v(" 度到"),a("code",[s._v("85.05112878")]),s._v(" 度。")]),s._v(" "),a("p",[s._v("当坐标位置超出指定范围时，该命令将会返回一个错误。已经添加的数据，是无法再次往里面添加的。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd china:city "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("121.47")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.23")]),s._v(" shanghai\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geoadd china:city "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106.50")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29.53")]),s._v(" chongqing "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22.52")]),s._v(" shenzhen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("116.38")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.90")]),s._v(" beijing\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"_2-geopos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-geopos"}},[s._v("#")]),s._v(" 2. geopos")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("geopos key member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得指定地区的坐标值")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# e,g.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geopos china:city shanghai\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"121.47000163793563843"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"31.22999903975783553"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_3-geodist"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-geodist"}},[s._v("#")]),s._v(" 3. geodist")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("geodist key member1 member2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("km"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ft"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取两个位置之间的直线距离")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("获取两个位置之间的直线距离")]),s._v(" "),a("p",[s._v("单位：")]),s._v(" "),a("ul",[a("li",[s._v("m 表示单位为米[默认值]。")]),s._v(" "),a("li",[s._v("km 表示单位为千米。")]),s._v(" "),a("li",[s._v("mi 表示单位为英里。")]),s._v(" "),a("li",[s._v("ft 表示单位为英尺。")])]),s._v(" "),a("p",[s._v("如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" geodist china:city beijing shanghai km\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1068.1535"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_4-georadius"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-georadius"}},[s._v("#")]),s._v(" 4. georadius")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以给定的经纬度为中心，找出某一半径内的元素")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 经度 纬度 距离 单位")]),s._v("\ngeoradius key longitude latitude radius m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("km"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("ft"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("mi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHCOORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHDIST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHHASH"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COUNT count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ASC"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("DESC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("STORE key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# e.g.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" georadius china:city "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" km\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"chongqing"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shenzhen"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_6-redis-jedis-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-redis-jedis-测试"}},[s._v("#")]),s._v(" 6. Redis-Jedis 测试")]),s._v(" "),a("h3",{attrs:{id:"_6-1-dependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-dependencies"}},[s._v("#")]),s._v(" 6.1 Dependencies")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("redis.clients"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("3.2.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_6-2-连接-redis-注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-连接-redis-注意事项"}},[s._v("#")]),s._v(" 6.2 连接  Redis  注意事项")]),s._v(" "),a("p",[s._v("禁用Linux的防火墙：Linux(CentOS7)里执行命令")]),s._v(" "),a("p",[a("code",[s._v("redis.conf")]),s._v("中注释掉"),a("code",[s._v("bind 127.0.0.1")]),s._v(" ,然后 "),a("code",[s._v("protected-mode no")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl stop/disable firewalld.service   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_6-3-连接redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-连接redis"}},[s._v("#")]),s._v(" 6.3 连接Redis")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clients"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" jedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.137.3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" pong "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"连接成功："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("pong"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_6-4-测试相关数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-测试相关数据类型"}},[s._v("#")]),s._v(" 6.4 测试相关数据类型")]),s._v(" "),a("h4",{attrs:{id:"_6-4-1-jedis-api-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-1-jedis-api-key"}},[s._v("#")]),s._v(" 6.4.1 Jedis-API::Key")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("keys")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nkeys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                \n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"_6-4-2-jedis-api-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-2-jedis-api-string"}},[s._v("#")]),s._v(" 6.4.2 Jedis-API::String")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"str3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_6-4-3-jedis-api-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-3-jedis-api-list"}},[s._v("#")]),s._v(" 6.4.3 Jedis-API::List")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lrange "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mylist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nlist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_6-4-4-jedis-api-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-4-jedis-api-set"}},[s._v("#")]),s._v(" 6.4.4 Jedis-API::Set")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order02"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order03"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order04"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" smembers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("smembers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nsmembers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("srem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"orders"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order02"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_6-4-5-jedis-api-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-5-jedis-api-hash"}},[s._v("#")]),s._v(" 6.4.5 Jedis-API::Hash")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hash1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hash1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userName"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" map "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"telphone"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"13810169999"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"atguigu"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc@163.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hmset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hash2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hmget")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hash2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"telphone"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nresult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"_6-4-6-jedis-api-zset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-6-jedis-api-zset"}},[s._v("#")]),s._v(" 6.4.6 Jedis-API::Zset")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zset01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"z3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zset01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"l4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zset01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"w5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\njedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zadd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zset01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"z6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" zrange "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("zrange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zset01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nzrange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_7-redis-jedis-实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-redis-jedis-实例"}},[s._v("#")]),s._v(" 7. Redis_Jedis_实例")]),s._v(" "),a("h3",{attrs:{id:"_7-1-完成一个手机验证码功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-完成一个手机验证码功能"}},[s._v("#")]),s._v(" 7.1 完成一个手机验证码功能")]),s._v(" "),a("p",[s._v("要求:")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("输入手机号，点击发送后随机生成6位数字码，2分钟有效")])]),s._v(" "),a("li",[a("p",[s._v("输入验证码，点击验证，返回成功或失败")])]),s._v(" "),a("li",[a("p",[s._v("每个手机号每天只能输入3次")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720140244779.png",alt:"image-20210720140244779"}})]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clients"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PhoneCode")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//       verifyCode("18317060736");')]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18317060736"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"315605"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Random")]),s._v(" random "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),s._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rand "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" random"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nextInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("verifyCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" phone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" jedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//拼接key")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//手机发送次数key")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" countKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VerifyCode"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" phone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":count"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//验证码key")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" codeKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VerifyCode"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" phone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//没个手机每天只能发送三次")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("countKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//第一次发送")]),s._v("\n            jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("countKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//发送次数+1")]),s._v("\n            jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("countKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//三次了，不能发送了")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"已经3次了"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//储存验证码")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" vcode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codeKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vcode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" phone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" jedis "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//验证码key")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" codeKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VerifyCode"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" phone "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" redisCode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("codeKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisCode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fail"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        jedis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br")])]),a("h2",{attrs:{id:"_8-redis与-spring-boot-整合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-redis与-spring-boot-整合"}},[s._v("#")]),s._v(" 8. Redis与  Spring Boot  整合")]),s._v(" "),a("p",[s._v("Spring Boot整合Redis非常简单，只需要按如下步骤整合即可")]),s._v(" "),a("h3",{attrs:{id:"_8-1-整合步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-整合步骤"}},[s._v("#")]),s._v(" 8.1 整合步骤")]),s._v(" "),a("ol",[a("li",[s._v("在pom.xml文件中引入redis相关依赖")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- redis --\x3e")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-data-redis"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- spring2.X集成redis所需common-pool2--\x3e")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.commons"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("commons-pool2"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.6.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("application.properties配置redis配置")])]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Redis服务器地址")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("192.168.140.136")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Redis服务器连接端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("6379")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Redis数据库索引（默认为0）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接超时时间（毫秒）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1800000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接池最大连接数（使用负值表示没有限制）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.lettuce.pool.max-active")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最大阻塞等待时间(负数表示没限制)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.lettuce.pool.max-wait")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接池中的最大空闲连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.lettuce.pool.max-idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接池中的最小空闲连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.redis.lettuce.pool.min-idle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("添加redis配置类")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@EnableCaching")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConfig")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CachingConfigurerSupport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("redisTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConnectionFactory")]),s._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" template "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisSerializer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" redisSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),s._v(" jackson2JsonRedisSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),s._v(" om "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setVisibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PropertyAccessor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JsonAutoDetect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Visibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ANY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enableDefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NON_FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       jackson2JsonRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setConnectionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// key序列化方式")]),s._v("\n       template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setKeySerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// value序列化")]),s._v("\n       template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setValueSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jackson2JsonRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// value hashmap序列化")]),s._v("\n       template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHashValueSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jackson2JsonRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" template"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CacheManager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cacheManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisConnectionFactory")]),s._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisSerializer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" redisSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),s._v(" jackson2JsonRedisSerializer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jackson2JsonRedisSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 解决查询缓存转换异常的问题")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),s._v(" om "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setVisibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PropertyAccessor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JsonAutoDetect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Visibility")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ANY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("enableDefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ObjectMapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DefaultTyping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NON_FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       jackson2JsonRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setObjectMapper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("om"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置序列化（解决乱码的问题）,过期时间600秒")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisCacheConfiguration")]),s._v(" config "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisCacheConfiguration")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("defaultCacheConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("entryTtl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Duration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ofSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("serializeKeysWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisSerializationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SerializationPair")]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("serializeValuesWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisSerializationContext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SerializationPair")]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jackson2JsonRedisSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("disableCachingNullValues")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisCacheManager")]),s._v(" cacheManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisCacheManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cacheDefaults")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cacheManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("测试一下")])]),s._v(" "),a("p",[s._v("RedisTestController中添加测试方法")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RequestMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/redisTest"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTestController")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RedisTemplate")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testRedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置值到redis")]),s._v("\n        redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lucy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//从redis获取值")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"_9-redis-事务-锁机制-秒杀"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-redis-事务-锁机制-秒杀"}},[s._v("#")]),s._v(" 9. Redis 事务 锁机制 秒杀")]),s._v(" "),a("h3",{attrs:{id:"_9-1-redis-的事务定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-redis-的事务定义"}},[s._v("#")]),s._v(" 9.1 Redis  的事务定义")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720142124856.png",alt:"image-20210720142124856"}})]),s._v(" "),a("p",[s._v("Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。")]),s._v(" "),a("p",[s._v("Redis事务的主要作用就是串联多个命令防止别的命令插队。")]),s._v(" "),a("h3",{attrs:{id:"_9-2-multi-exec-discard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-multi-exec-discard"}},[s._v("#")]),s._v(" 9.2 Multi & Exec & discard")]),s._v(" "),a("p",[s._v("从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。")]),s._v(" "),a("p",[s._v("组队的过程中可以通过discard来放弃组队。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720142224879.png",alt:"image-20210720142224879"}})]),s._v(" "),a("p",[s._v("案例：")]),s._v(" "),a("blockquote",[a("p",[s._v("组队成功，提交成功")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k2 v2\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k3 v3\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("组队阶段报错，提交失败")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" m1 v1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" m2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ERR wrong number of arguments "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'set'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" m3 v3\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" EXECABORT Transaction discarded because of previous errors.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("组队成功，提交有成功有失败情况")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" multi\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" m1 v1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" incr m1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" m2 v2\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ERR value is not an integer or out of range\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"_9-3-事务的错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-事务的错误处理"}},[s._v("#")]),s._v(" 9.3 事务的错误处理")]),s._v(" "),a("p",[s._v("组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145445098.png",alt:"image-20210720145445098"}})]),s._v(" "),a("p",[s._v("如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，而其他的命令都会执行，不会回滚。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145450386.png",alt:"image-20210720145450386"}})]),s._v(" "),a("blockquote",[a("p",[s._v("为什么要做成事务")])]),s._v(" "),a("p",[s._v("想想一个场景：有很多人有你的账户,同时去参加双十一抢购")]),s._v(" "),a("h3",{attrs:{id:"_9-4-事务冲突的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-事务冲突的问题"}},[s._v("#")]),s._v(" 9.4 事务冲突的问题")]),s._v(" "),a("p",[s._v("例子")]),s._v(" "),a("p",[s._v("一个请求想给金额减8000")]),s._v(" "),a("p",[s._v("一个请求想给金额减5000")]),s._v(" "),a("p",[s._v("一个请求想给金额减1000")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145521543.png",alt:"image-20210720145521543"}})]),s._v(" "),a("h4",{attrs:{id:"_9-4-1-悲观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-1-悲观锁"}},[s._v("#")]),s._v(" 9.4.1 悲观锁")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145526346.png",alt:"image-20210720145526346"}})]),s._v(" "),a("p",[s._v("悲观锁(Pessimistic Lock) , 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。 传统的关系型数据库里边就用到了很多这种锁机制 ，比如 行锁 ， 表锁 等， 读锁 ， 写锁 等，都是在做操作之前先上锁。")]),s._v(" "),a("h4",{attrs:{id:"_9-4-2-乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-2-乐观锁"}},[s._v("#")]),s._v(" 9.4.2 乐观锁")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145600073.png",alt:"image-20210720145600073"}})]),s._v(" "),a("p",[s._v("乐观锁(Optimistic Lock)  ,  顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。 乐观锁适用于多读的应用类型，这样可以提高吞吐量 。Redis就是利用这种check-and-set机制实现事务的。")]),s._v(" "),a("h4",{attrs:{id:"_9-4-3-watch-key-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-3-watch-key-key"}},[s._v("#")]),s._v(" 9.4.3 WATCH   key   [key ...]")]),s._v(" "),a("p",[s._v("在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务 执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145637660.png",alt:"image-20210720145637660"}})]),s._v(" "),a("h4",{attrs:{id:"_9-4-4-unwatch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-4-unwatch"}},[s._v("#")]),s._v(" 9.4.4 unwatch")]),s._v(" "),a("p",[s._v("取消 WATCH 命令对所有 key 的监视。")]),s._v(" "),a("p",[s._v("如果在执行 WATCH 命令之后，EXEC 命令或DISCARD 命令先被执行了的话，那么就不需要再执行UNWATCH 了。")]),s._v(" "),a("p",[s._v("http://doc.redisfans.com/transaction/exec.html")]),s._v(" "),a("h3",{attrs:{id:"_9-5-redis-事务三特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-redis-事务三特性"}},[s._v("#")]),s._v(" 9.5 Redis  事务三特性")]),s._v(" "),a("p",[s._v("Ø 单独的隔离操作")]),s._v(" "),a("p",[s._v("n 事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。")]),s._v(" "),a("p",[s._v("Ø 没有隔离级别的概念")]),s._v(" "),a("p",[s._v("n 队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行")]),s._v(" "),a("p",[s._v("Ø 不保证原子性")]),s._v(" "),a("p",[s._v("n 事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚")]),s._v(" "),a("h2",{attrs:{id:"_10-redis-事务-秒杀案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-redis-事务-秒杀案例"}},[s._v("#")]),s._v(" 10.  Redis 事务 秒杀案例")]),s._v(" "),a("h3",{attrs:{id:"_10-1-解决计数器和人员记录的事务操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-解决计数器和人员记录的事务操作"}},[s._v("#")]),s._v(" 10.1 解决计数器和人员记录的事务操作")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720145755705.png",alt:"image-20210720145755705"}})]),s._v(" "),a("h3",{attrs:{id:"_10-2-redis-事务-秒杀并发模拟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-redis-事务-秒杀并发模拟"}},[s._v("#")]),s._v(" 10.2 Redis  事务  --  秒杀并发模拟")]),s._v(" "),a("p",[s._v("使用工具ab模拟测试")]),s._v(" "),a("p",[s._v("CentOS6 默认安装")]),s._v(" "),a("p",[s._v("CentOS7需要手动安装")]),s._v(" "),a("p",[s._v("联网：  yum install httpd-tools")]),s._v(" "),a("p",[s._v("无网络")]),s._v(" "),a("p",[s._v("（1） 进入cd  /run/media/root/CentOS 7 x86_64/Packages（路径跟centos6不同）")]),s._v(" "),a("p",[s._v("（2） 顺序安装")]),s._v(" "),a("p",[s._v("apr-1.4.8-3.el7.x86_64.rpm")]),s._v(" "),a("p",[s._v("apr-util-1.5.2-6.el7.x86_64.rpm")]),s._v(" "),a("p",[s._v("httpd-tools-2.4.6-67.el7.centos.x86_64.rpm")]),s._v(" "),a("p",[s._v("测试及结果")]),s._v(" "),a("p",[s._v("通过  ab  测试")]),s._v(" "),a("p",[s._v("vim postfile 模拟表单提交参数,以&符号结尾;存放当前目录。")]),s._v(" "),a("p",[s._v("内容：prodid=0101&")]),s._v(" "),a("p",[s._v("ab -n 2000 -c 200 -k -p ~/postfile -T application/x-www-form-urlencoded http://192.168.2.115:8081/Seckill/doseckill")]),s._v(" "),a("p",[s._v("超卖")]),s._v(" "),a("h3",{attrs:{id:"_10-3-超卖问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-超卖问题"}},[s._v("#")]),s._v(" 10.3 超卖问题")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/10.3_1_1.png",alt:"image-20210720145858500"}})]),s._v(" "),a("h3",{attrs:{id:"_10-4-利用乐观锁淘汰用户-解决超卖问题。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-利用乐观锁淘汰用户-解决超卖问题。"}},[s._v("#")]),s._v(" 10.4 利用乐观锁淘汰用户，解决超卖问题。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/10.4_1.png",alt:"image-20210720145911145"}})]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//增加乐观锁jedis.watch(qtkey); //3.判断库存String qtkeystr = jedis.get(qtkey);if(qtkeystr==null \\|\\| "".equals(qtkeystr.trim())) {System.out.println("未初始化库存");jedis.close();return false ;} int qt = Integer.parseInt(qtkeystr);if(qt<=0) {System.err.println("已经秒光");jedis.close();return false;} //增加事务Transaction  multi  = jedis.multi(); //4.减少库存//jedis.decr(qtkey); multi .decr(qtkey); //5.加人//jedis.sadd(usrkey, uid); multi .sadd(usrkey, uid); //执行事务List<Object> list =  multi .exec(); //判断事务提交是否失败if(list==null \\|\\| list.size()==0) {System.out.println("秒杀失败");jedis.close();return false;}System.err.print ln("秒杀成 功");jedis.close();')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/10.4_2.png",alt:"image-20210720175437842"}})]),s._v(" "),a("img",{staticStyle:{zoom:"25%"},attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175443349.png",alt:"image-20210720175443349"}}),s._v(" "),a("p",[s._v("继续增加并发测试")]),s._v(" "),a("p",[s._v("连接有限制")]),s._v(" "),a("p",[s._v("ab -n 2000 -c 200 -k -p postfile -T 'application/x-www-form-urlencoded' http://192.168.140.1:8080/seckill/doseckill")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175513508.png",alt:"image-20210720175513508"}})]),s._v(" "),a("p",[s._v("增加-r参数，-r  Don't exit on socket receive errors.")]),s._v(" "),a("p",[s._v("ab -n 2000 -c 100 -r -p postfile -T 'application/x-www-form-urlencoded'  "),a("a",{attrs:{href:"http://192.168.140.1:8080/seckill/doseckill",target:"_blank",rel:"noopener noreferrer"}},[s._v(" http://192.168.  140  .1:8080/seckill/doseckill "),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("已经秒光，可是还有库存")]),s._v(" "),a("p",[s._v("ab -n 2000 -c 100 -p postfile -T 'application/x-www-form-urlencoded' http://192.168.137.1:8080/seckill/doseckill")]),s._v(" "),a("p",[s._v("已经秒光，可是还有库存。原因，就是乐观锁导致很多请求都失败。先点的没秒到，后点的可能秒到了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175522864.png",alt:"image-20210720175522864"}})]),s._v(" "),a("p",[s._v("连接超时，通过连接池解决")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175527497.png",alt:"image-20210720175527497"}})]),s._v(" "),a("p",[s._v("连接池")]),s._v(" "),a("p",[s._v("节省每次连接redis服务带来的消耗，把连接好的实例反复利用。")]),s._v(" "),a("p",[s._v("通过参数管理连接的行为")]),s._v(" "),a("p",[s._v("代码见项目中")]),s._v(" "),a("p",[s._v("l 链接池参数")]),s._v(" "),a("p",[s._v("n MaxTotal：控制一个pool可分配多少个jedis实例，通过pool.getResource()来获取；如果赋值为-1，则表示不限制；如果pool已经分配了MaxTotal个jedis实例，则此时pool的状态为exhausted。")]),s._v(" "),a("p",[s._v("n maxIdle：控制一个pool最多有多少个状态为idle(空闲)的jedis实例；")]),s._v(" "),a("p",[s._v("n MaxWaitMillis：表示当borrow一个jedis实例时，最大的等待毫秒数，如果超过等待时间，则直接抛JedisConnectionException；")]),s._v(" "),a("p",[s._v("n testOnBorrow：获得一个jedis实例的时候是否检查连接可用性（ping()）；如果为true，则得到的jedis实例均是可用的；")]),s._v(" "),a("p",[s._v("解决库存遗留问题")]),s._v(" "),a("p",[s._v("LUA脚本")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175534945.png",alt:"image-20210720175534945"}})]),s._v(" "),a("p",[s._v("Lua 是一个小巧的"),a("a",{attrs:{href:"http://baike.baidu.com/item/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80",target:"_blank",rel:"noopener noreferrer"}},[s._v("脚本语言"),a("OutboundLink")],1),s._v("，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。")]),s._v(" "),a("p",[s._v("很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。")]),s._v(" "),a("p",[s._v("这其中包括魔兽争霸地图、魔兽世界、博德之门、愤怒的小鸟等众多游戏插件或外挂。")]),s._v(" "),a("p",[s._v("https://www.w3cschool.cn/lua/")]),s._v(" "),a("p",[s._v("LUA脚本在  Redis  中的优势")]),s._v(" "),a("p",[s._v("将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。")]),s._v(" "),a("p",[s._v("LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。")]),s._v(" "),a("p",[s._v("但是注意redis的lua脚本功能，只有在Redis 2.6以上的版本才可以使用。")]),s._v(" "),a("p",[s._v("利用lua脚本淘汰用户，解决超卖问题。")]),s._v(" "),a("p",[s._v("redis 2.6版本以后，通过lua脚本解决 争抢问题 ，实际上是 redis 利用其单线程的特性，用任务队列的方式解决多任务并发问题 。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175543200.png",alt:"image-20210720175543200"}})]),s._v(" "),a("p",[s._v("Redis_事务_秒杀案例  _  代码")]),s._v(" "),a("p",[s._v("项目结构")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175551304.png",alt:"image-20210720175551304"}})]),s._v(" "),a("p",[s._v("第一版：简单版")]),s._v(" "),a("p",[s._v("老师点10次，正常秒杀")]),s._v(" "),a("p",[s._v("同学一起点试一试，秒杀也是正常的。这是因为还达不到并发的效果。")]),s._v(" "),a("p",[s._v("使用工具ab模拟并发测试，会出现超卖情况。查看库存会出现负数。")]),s._v(" "),a("p",[s._v("第二版：加事务-乐观锁(解决超卖),但出现遗留库存和连接超时")]),s._v(" "),a("p",[s._v("第三版：连接池解决超时问题")]),s._v(" "),a("p",[s._v("第四版：解决库存依赖问题，  LUA  脚本")]),s._v(" "),a("div",{staticClass:"language-lua line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-lua"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" userid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" prodid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" qtkey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sk:"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("..")]),s._v("prodid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('":qt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" usersKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sk:"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("..")]),s._v("prodid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("usr'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" userExists"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sismember"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("usersKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("userid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tonumber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userExists"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),s._v(" num"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("qtkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tonumber")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" \n  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"decr"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("qtkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sadd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("usersKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("userid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"_11-redis持久化之-rdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-redis持久化之-rdb"}},[s._v("#")]),s._v(" 11. Redis持久化之  RDB")]),s._v(" "),a("blockquote",[a("p",[s._v("官网介绍：http://www.redis.io")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720153609930.png",alt:"image-20210720153609930"}})]),s._v(" "),a("p",[s._v("Redis 提供了2个不同形式的持久化方式。")]),s._v(" "),a("ul",[a("li",[s._v("RDB（Redis DataBase）")]),s._v(" "),a("li",[s._v("AOF（Append Of File）")])]),s._v(" "),a("h3",{attrs:{id:"_11-1-redis-database-rdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-redis-database-rdb"}},[s._v("#")]),s._v(" 11.1 Redis DataBase - RDB")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720153700787.png",alt:"image-20210720153700787"}})]),s._v(" "),a("p",[s._v("在指定的时间间隔内将内存中的数据集快照写入磁盘， 也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里")]),s._v(" "),a("blockquote",[a("p",[s._v("备份是如何执行的")])]),s._v(" "),a("p",[s._v("Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。 整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。 RDB的缺点是  最后一次持久化后的数据可能丢失 。")]),s._v(" "),a("blockquote",[a("p",[s._v("Fork")])]),s._v(" "),a("ul",[a("li",[s._v("Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程")]),s._v(" "),a("li",[s._v("在Linux程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后多会exec系统调用，出于效率考虑，Linux中引入了“ 写时复制技术 ”")]),s._v(" "),a("li",[s._v("一般情况父进程和子进程会共用同一段物理内存 ，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。")])]),s._v(" "),a("h3",{attrs:{id:"_11-2-rdb持久化流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-rdb持久化流程"}},[s._v("#")]),s._v(" 11.2 RDB持久化流程")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720153819209.png",alt:"image-20210720153819209"}})]),s._v(" "),a("h3",{attrs:{id:"_11-3-dump-rdb文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-3-dump-rdb文件"}},[s._v("#")]),s._v(" 11.3 dump.rdb文件")]),s._v(" "),a("p",[s._v("在redis.conf中配置文件名称，默认为dump.rdb")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720153953508.png",alt:"image-20210720153953508"}})]),s._v(" "),a("blockquote",[a("p",[s._v("配置位置")])]),s._v(" "),a("p",[s._v("rdb文件的保存路径，也可以修改。默认为Redis启动时命令行所在的目录下")]),s._v(" "),a("p",[s._v('dir "/myredis/"')]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154005246.png",alt:"image-20210720154005246"}})]),s._v(" "),a("h3",{attrs:{id:"_11-4-如何触发rdb快照-保持策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-4-如何触发rdb快照-保持策略"}},[s._v("#")]),s._v(" 11.4 如何触发RDB快照；保持策略")]),s._v(" "),a("blockquote",[a("p",[s._v("配置文件中默认的快照配置")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154038592.png",alt:"image-20210720154038592"}})]),s._v(" "),a("blockquote",[a("p",[s._v("命令  save VS bgsave")])]),s._v(" "),a("p",[s._v("save ：save时只管保存，其它不管，全部阻塞。手动保存。不建议。")]),s._v(" "),a("p",[s._v("bgsave：  Redis  会在后台异步进行快照操作， 快照同时还可以响应客户端请求。")]),s._v(" "),a("p",[s._v("可以通过lastsave 命令获取最后一次成功执行快照的时间")]),s._v(" "),a("blockquote",[a("p",[s._v("flushall  命令")])]),s._v(" "),a("p",[s._v("执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义")]),s._v(" "),a("h3",{attrs:{id:"_11-5-snapshotting-快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-snapshotting-快照"}},[s._v("#")]),s._v(" 11.5 SNAPSHOTTING  快照")]),s._v(" "),a("h4",{attrs:{id:"_11-5-1-save"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-1-save"}},[s._v("#")]),s._v(" 11.5.1 Save")]),s._v(" "),a("p",[s._v("格式：save 秒钟 写操作次数")]),s._v(" "),a("p",[s._v("RDB是整个内存的压缩过的Snapshot，RDB的数据结构，可以配置复合的快照触发条件，")]),s._v(" "),a("p",[s._v("默认是1分钟内改了  1  万次，或  5  分钟内改了  10  次，或  15  分钟内改了  1  次。")]),s._v(" "),a("p",[s._v("禁用")]),s._v(" "),a("p",[s._v("不设置save指令，或者给save传入空字符串")]),s._v(" "),a("h4",{attrs:{id:"_11-5-2-stop-writes-on-bgsave-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-2-stop-writes-on-bgsave-error"}},[s._v("#")]),s._v(" 11.5.2 stop-writes-on-bgsave-error")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154135550.png",alt:"image-20210720154135550"}})]),s._v(" "),a("p",[s._v("当Redis无法写入磁盘的话，直接关掉Redis的写操作。推荐yes.")]),s._v(" "),a("h4",{attrs:{id:"_11-5-3-rdbcompression-压缩文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-3-rdbcompression-压缩文件"}},[s._v("#")]),s._v(" 11.5.3 rdbcompression   压缩文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154153892.png",alt:"image-20210720154153892"}})]),s._v(" "),a("p",[s._v("对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。")]),s._v(" "),a("p",[s._v("如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能。推荐yes.")]),s._v(" "),a("h4",{attrs:{id:"_11-5-4-rdbchecksum-检查完整性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-4-rdbchecksum-检查完整性"}},[s._v("#")]),s._v(" 11.5.4 rdbchecksum   检查完整性")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154204123.png",alt:"image-20210720154204123"}})]),s._v(" "),a("p",[s._v("在存储快照后，还可以让redis使用CRC64算法来进行数据校验，")]),s._v(" "),a("p",[s._v("但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能")]),s._v(" "),a("p",[s._v("推荐yes.")]),s._v(" "),a("h4",{attrs:{id:"_11-5-5-rdb-的备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-5-5-rdb-的备份"}},[s._v("#")]),s._v(" 11.5.5 rdb  的备份")]),s._v(" "),a("p",[s._v("先通过config get dir  查询rdb文件的目录")]),s._v(" "),a("p",[s._v("将*.rdb的文件拷贝到别的地方")]),s._v(" "),a("p",[s._v("rdb的恢复")]),s._v(" "),a("p",[s._v("u 关闭Redis")]),s._v(" "),a("p",[s._v("u 先把备份的文件拷贝到工作目录下 cp dump2.rdb dump.rdb")]),s._v(" "),a("p",[s._v("u 启动Redis, 备份数据会直接加载")]),s._v(" "),a("blockquote",[a("p",[s._v("优势")])]),s._v(" "),a("p",[s._v("l 适合大规模的数据恢复")]),s._v(" "),a("p",[s._v("l 对数据完整性和一致性要求不高更适合使用")]),s._v(" "),a("p",[s._v("l 节省磁盘空间")]),s._v(" "),a("p",[s._v("l 恢复速度快")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154232770.png",alt:"image-20210720154232770"}})]),s._v(" "),a("blockquote",[a("p",[s._v("劣势")])]),s._v(" "),a("p",[s._v("l Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑")]),s._v(" "),a("p",[s._v("l 虽然Redis在fork时使用了 写时拷贝技术 ,但是如果数据庞大时还是比较消耗性能。")]),s._v(" "),a("p",[s._v("l 在备份周期在一定间隔时间做一次备份，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。")]),s._v(" "),a("blockquote",[a("p",[s._v("如何停止")])]),s._v(" "),a("p",[s._v('动态停止RDB：redis-cli config set save ""#save后给空值，表示禁用保存策略')]),s._v(" "),a("blockquote",[a("p",[s._v("小总结")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154309673.png",alt:"image-20210720154309673"}})]),s._v(" "),a("h2",{attrs:{id:"_12-redis持久化之-aof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-redis持久化之-aof"}},[s._v("#")]),s._v(" 12. Redis持久化之  AOF")]),s._v(" "),a("h3",{attrs:{id:"_12-1-aof-append-only-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-aof-append-only-file"}},[s._v("#")]),s._v(" 12.1 AOF  （  Append Only File  ）")]),s._v(" "),a("p",[s._v("以 日志 的形式来记录每个写操作（增量保存），将Redis执行过的所有写指令记录下来( 读操作不记录 )，  只许追加文件但不可以改写文件 ，redis启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作")]),s._v(" "),a("p",[s._v("AOF持久化流程")]),s._v(" "),a("p",[s._v("（1）客户端的请求写命令会被append追加到AOF缓冲区内；")]),s._v(" "),a("p",[s._v("（2）AOF缓冲区根据AOF持久化策略[always,everysec,no]将操作sync同步到磁盘的AOF文件中；")]),s._v(" "),a("p",[s._v("（3）AOF文件大小超过重写策略或手动重写时，会对AOF文件rewrite重写，压缩AOF文件容量；")]),s._v(" "),a("p",[s._v("（4）Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的；")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 15.44.24](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 15.44.24.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("AOF默认不开启")])]),s._v(" "),a("p",[s._v("可以在redis.conf中配置文件名称，默认为 appendonly.aof")]),s._v(" "),a("p",[s._v("AOF文件的保存路径，同RDB的路径一致。")]),s._v(" "),a("blockquote",[a("p",[s._v("AOF和  RDB  同时开启，  redis  听谁的？")])]),s._v(" "),a("p",[s._v("AOF和RDB同时开启，系统默认取AOF的数据（数据不会存在丢失）")]),s._v(" "),a("h4",{attrs:{id:"_12-1-1-aof启动-修复-恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-1-aof启动-修复-恢复"}},[s._v("#")]),s._v(" 12.1.1 AOF启动  /  修复  /  恢复")]),s._v(" "),a("p",[s._v("l AOF的备份机制和性能虽然和RDB不同, 但是备份和恢复的操作同RDB一样，都是拷贝备份文件，需要恢复时再拷贝到Redis工作目录下，启动系统即加载。")]),s._v(" "),a("p",[s._v("l 正常恢复")]),s._v(" "),a("p",[s._v("n 修改默认的appendonly no，改为yes")]),s._v(" "),a("p",[s._v("n 将有数据的aof文件复制一份保存到对应目录(查看目录：config get dir)")]),s._v(" "),a("p",[s._v("n 恢复：重启redis然后重新加载")]),s._v(" "),a("p",[s._v("l 异常恢复")]),s._v(" "),a("p",[s._v("n 修改默认的appendonly no，改为yes")]),s._v(" "),a("p",[s._v("n 如遇到 AOF文件损坏 ，通过/usr/local/bin/ redis-check-aof--fix appendonly.aof 进行恢复")]),s._v(" "),a("p",[s._v("n 备份被写坏的AOF文件")]),s._v(" "),a("p",[s._v("n 恢复：重启redis，然后重新加载")]),s._v(" "),a("h4",{attrs:{id:"_12-1-2-aof同步频率设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-2-aof同步频率设置"}},[s._v("#")]),s._v(" 12.1.2 AOF同步频率设置")]),s._v(" "),a("p",[s._v("appendfsync always")]),s._v(" "),a("p",[s._v("始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好")]),s._v(" "),a("p",[s._v("appendfsync everysec")]),s._v(" "),a("p",[s._v("每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。")]),s._v(" "),a("p",[s._v("appendfsync no")]),s._v(" "),a("p",[s._v("redis不主动进行同步，把同步时机交给操作系统。")]),s._v(" "),a("h4",{attrs:{id:"_12-1-3-rewrite压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-1-3-rewrite压缩"}},[s._v("#")]),s._v(" 12.1.3 Rewrite压缩")]),s._v(" "),a("p",[s._v("AOF采用文件追加方式，文件会越来越大为避免出现此种情况，新增了重写机制, 当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩， 只保留可以恢复数据的最小指令集.可以使用命令bgrewriteaof")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("重写原理，如何实现重写")])])]),s._v(" "),a("p",[s._v("AOF文件持续增长而过大时，会fork出一条新进程来将文件重写(也是先写临时文件最后再rename)，redis4.0版本后的重写，是指上就是把rdb 的快照，以二级制的形式附在新的aof头部，作为已有的历史数据，替换掉原来的流水账操作。")]),s._v(" "),a("p",[s._v("no-appendfsync-on-rewrite：")]),s._v(" "),a("p",[s._v("如果 no-appendfsync-on-rewrite=yes ,不写入aof文件只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高性能）")]),s._v(" "),a("p",[s._v("​\t如果 no-appendfsync-on-rewrite=no,  还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）")]),s._v(" "),a("p",[s._v("触发机制，何时重写")]),s._v(" "),a("p",[s._v("Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发")]),s._v(" "),a("p",[s._v("重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定Redis要满足一定条件才会进行重写。")]),s._v(" "),a("p",[s._v("auto-aof-rewrite-percentage：设置重写的基准值，文件达到100%时开始重写（文件是原来重写后文件的2倍时触发）")]),s._v(" "),a("p",[s._v("auto-aof-rewrite-min-size：设置重写的基准值，最小文件64MB。达到这个值开始重写。")]),s._v(" "),a("p",[s._v("例如：文件达到70MB开始重写，降到50MB，下次什么时候开始重写？100MB")]),s._v(" "),a("p",[s._v("系统载入时或者上次重写完毕时，Redis会记录此时AOF大小，设为base_size,")]),s._v(" "),a("p",[s._v("如果Redis的AOF当前大小>= base_size +base_size*100% (默认)且当前大小>=64mb(默认)的情况下，Redis会对AOF进行重写。")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("重写流程")])])]),s._v(" "),a("p",[s._v("（1）bgrewriteaof触发重写，判断是否当前有bgsave或bgrewriteaof在运行，如果有，则等待该命令结束后再继续执行。")]),s._v(" "),a("p",[s._v("（2）主进程fork出子进程执行重写操作，保证主进程不会阻塞。")]),s._v(" "),a("p",[s._v("（3）子进程遍历redis内存中数据到临时文件，客户端的写请求同时写入aof_buf缓冲区和aof_rewrite_buf重写缓冲区保证原AOF文件完整以及新AOF文件生成期间的新的数据修改动作不会丢失。")]),s._v(" "),a("p",[s._v("（4）1).子进程写完新的AOF文件后，向主进程发信号，父进程更新统计信息。2).主进程把aof_rewrite_buf中的数据写入到新的AOF文件。")]),s._v(" "),a("p",[s._v("（5）使用新的AOF文件覆盖旧的AOF文件，完成AOF重写。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 15.46.48](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 15.46.48.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("优势")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154706515.png",alt:"image-20210720154706515"}})]),s._v(" "),a("p",[s._v("n 备份机制更稳健，丢失数据概率更低。")]),s._v(" "),a("p",[s._v("n 可读的日志文本，通过操作AOF稳健，可以处理误操作。")]),s._v(" "),a("blockquote",[a("p",[s._v("劣势")])]),s._v(" "),a("p",[s._v("n 比起RDB占用更多的磁盘空间。")]),s._v(" "),a("p",[s._v("n 恢复备份速度要慢。")]),s._v(" "),a("p",[s._v("n 每次读写都同步的话，有一定的性能压力。")]),s._v(" "),a("p",[s._v("n 存在个别Bug，造成恢复不能。")]),s._v(" "),a("blockquote",[a("p",[s._v("小总结")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154720576.png",alt:"image-20210720154720576"}})]),s._v(" "),a("h3",{attrs:{id:"_12-2-总结-which-one"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-2-总结-which-one"}},[s._v("#")]),s._v(" 12.2 总结  (Which one)")]),s._v(" "),a("p",[s._v("官方推荐两个都启用。如果对数据不敏感，可以选单独用RDB。")]),s._v(" "),a("p",[s._v("不建议单独用 AOF，因为可能会出现Bug。如果只是做纯内存缓存，可以都不用。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720154742655.png",alt:"image-20210720154742655"}})]),s._v(" "),a("p",[s._v("l RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储")]),s._v(" "),a("p",[s._v("l AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾.")]),s._v(" "),a("p",[s._v("l Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大")]),s._v(" "),a("p",[s._v("l 只做缓存：如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.")]),s._v(" "),a("p",[s._v("l 同时开启两种持久化方式")]),s._v(" "),a("p",[s._v("l 在这种情况下,当redis重启的时候会优先载入AOF文件来恢复原始的数据, 因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.")]),s._v(" "),a("p",[s._v("l RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？")]),s._v(" "),a("p",[s._v("l 建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)， 快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段。")]),s._v(" "),a("blockquote",[a("p",[s._v("性能建议")])]),s._v(" "),a("p",[s._v("因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。 如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上。默认超过原大小100%大小时重写可以改到适当的数值。")]),s._v(" "),a("h2",{attrs:{id:"_13-redis-主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-redis-主从复制"}},[s._v("#")]),s._v(" 13. Redis_主从复制")]),s._v(" "),a("p",[s._v("主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制， Master以写为主，  Slave  以读为主。")]),s._v(" "),a("p",[s._v("l 读写分离，性能扩展")]),s._v(" "),a("p",[s._v("l 容灾快速恢复")]),s._v(" "),a("p",[s._v("![image-20210720154851050](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 15.49.19.png)")]),s._v(" "),a("h3",{attrs:{id:"_13-1-主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-主从复制"}},[s._v("#")]),s._v(" 13.1 主从复制")]),s._v(" "),a("p",[s._v("拷贝多个redis.conf文件include(写绝对路径)")]),s._v(" "),a("p",[s._v("开启daemonize yes")]),s._v(" "),a("p",[s._v("Pid文件名字pidfile")]),s._v(" "),a("p",[s._v("指定端口port")]),s._v(" "),a("p",[s._v("Log文件名字")]),s._v(" "),a("p",[s._v("dump.rdb名字dbfilename")]),s._v(" "),a("p",[s._v("Appendonly 关掉或者换名字")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("新建redis6379.conf，填写以下内容")])])]),s._v(" "),a("p",[s._v("include /myredis/redis.conf")]),s._v(" "),a("p",[s._v("pidfile /var/run/redis_6379.pid")]),s._v(" "),a("p",[s._v("port 6379")]),s._v(" "),a("p",[s._v("dbfilename dump6379.rdb")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155104861.png",alt:"image-20210720155104861"}})]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("新建redis6380.conf，填写以下内容")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155110171.png",alt:"image-20210720155110171"}})]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("新建redis6381.conf，填写以下内容")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155119717.png",alt:"image-20210720155119717"}})]),s._v(" "),a("p",[s._v("slave-priority 10")]),s._v(" "),a("p",[s._v("设置从机的优先级，值越小，优先级越高，用于选举主机时使用。默认100")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"4"}},[a("li",[s._v("启动三台redis服务器")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155129433.png",alt:"image-20210720155129433"}})]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"5"}},[a("li",[s._v("查看系统进程，看看三台服务器是否启动")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155134697.png",alt:"image-20210720155134697"}})]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"6"}},[a("li",[s._v("查看三台主机运行情况")])])]),s._v(" "),a("p",[s._v("info replication")]),s._v(" "),a("p",[s._v("打印主从复制的相关信息")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155141186.png",alt:"image-20210720155141186"}})]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"7"}},[a("li",[s._v("配从(库  )  不配主  (  库  )")])])]),s._v(" "),a("p",[a("code",[s._v("slaveof <ip><port>")])]),s._v(" "),a("p",[s._v("成为某个实例的从服务器")]),s._v(" "),a("ol",[a("li",[s._v("在6380和6381上执行: slaveof 127.0.0.1 6379")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155149368.png",alt:"image-20210720155149368"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("在主机上写，在从机上可以读取数据")])]),s._v(" "),a("p",[s._v("在从机上写数据报错")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155157535.png",alt:"image-20210720155157535"}})]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("主机挂掉，重启就行，一切如初")])]),s._v(" "),a("li",[a("p",[s._v("从机重启需重设：slaveof 127.0.0.1 6379")])])]),s._v(" "),a("p",[s._v("可以将配置增加到文件中。永久生效。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720155203755.png",alt:"image-20210720155203755"}})]),s._v(" "),a("h3",{attrs:{id:"_13-2-常用-3-招"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-常用-3-招"}},[s._v("#")]),s._v(" 13.2 常用  3  招")]),s._v(" "),a("h4",{attrs:{id:"_13-2-1-一主二仆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-1-一主二仆"}},[s._v("#")]),s._v(" 13.2.1 一主二仆")]),s._v(" "),a("p",[s._v("切入点问题？slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？")]),s._v(" "),a("p",[s._v("从机是否可以写？set可否？")]),s._v(" "),a("p",[s._v("主机shutdown后情况如何？从机是上位还是原地待命？")]),s._v(" "),a("p",[s._v("主机又回来了后，主机新增记录，从机还能否顺利复制？")]),s._v(" "),a("p",[s._v("其中一台从机down后情况如何？依照原有它能跟上大部队吗？")]),s._v(" "),a("p",[s._v("![image-20210720155253234](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 15.53.06.png)")]),s._v(" "),a("h4",{attrs:{id:"_13-2-2-薪火相传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-2-薪火相传"}},[s._v("#")]),s._v(" 13.2.2 薪火相传")]),s._v(" "),a("p",[s._v("上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master, 可以有效减轻master的写压力,去中心化降低风险。")]),s._v(" "),a("p",[s._v("用 "),a("code",[s._v("slaveof <ip><port>")])]),s._v(" "),a("p",[s._v("中途变更转向:会清除之前的数据，重新建立拷贝最新的")]),s._v(" "),a("p",[s._v("风险是一旦某个slave宕机，后面的slave都没法备份")]),s._v(" "),a("p",[s._v("主机挂了，从机还是从机，无法写数据了")]),s._v(" "),a("p",[s._v("![image-20210720160652299](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.07.14.png)")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720160659158.png",alt:"image-20210720160659158"}})]),s._v(" "),a("h4",{attrs:{id:"_13-2-3-反客为主"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-3-反客为主"}},[s._v("#")]),s._v(" 13.2.3 反客为主")]),s._v(" "),a("p",[s._v("当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。")]),s._v(" "),a("p",[s._v("用 slaveof  no one  将从机变为主机。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720160750468.png",alt:"image-20210720160750468"}})]),s._v(" "),a("h3",{attrs:{id:"_13-3-复制原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-3-复制原理"}},[s._v("#")]),s._v(" 13.3 复制原理")]),s._v(" "),a("p",[s._v("l Slave启动成功连接到master后会发送一个sync命令")]),s._v(" "),a("p",[s._v("l Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步")]),s._v(" "),a("p",[s._v("l 全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。")]),s._v(" "),a("p",[s._v("l 增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步")]),s._v(" "),a("p",[s._v("l 但是只要是重新连接master,一次完全同步（全量复制)将被自动执行")]),s._v(" "),a("p",[s._v("![image-20210720160811493](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.08.20.png)")]),s._v(" "),a("h3",{attrs:{id:"_13-4-哨兵模式-sentinel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-哨兵模式-sentinel"}},[s._v("#")]),s._v(" 13.4 哨兵模式  (sentinel)")]),s._v(" "),a("p",[s._v("反客为主的自动版 ，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.10.35](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.10.35.png)")]),s._v(" "),a("h4",{attrs:{id:"_13-4-1-怎么玩-使用步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-1-怎么玩-使用步骤"}},[s._v("#")]),s._v(" 13.4.1 怎么玩(使用步骤  )")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("调整为一主二仆模式，  6379  带着  6380  、  6381")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720160930050.png",alt:"image-20210720160930050"}})]),s._v(" "),a("p",[s._v("自定义的  /myredis  目录下新建  sentinel.conf  文件，名字绝不能错")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("配置哨兵  ,  填写内容")])])]),s._v(" "),a("p",[s._v("sentinel monitor mymaster 127.0.0.1 6379 1")]),s._v(" "),a("p",[s._v("其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("启动哨兵")])])]),s._v(" "),a("p",[s._v("/usr/local/bin")]),s._v(" "),a("p",[s._v("redis做压测可以用自带的redis-benchmark工具")]),s._v(" "),a("p",[s._v("执行redis-sentinel  /myredis/sentinel.conf")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.11.59](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.11.59.png)")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"4"}},[a("li",[s._v("当主机挂掉，从机选举中产生新的主机")])])]),s._v(" "),a("p",[s._v("(大概10秒左右可以看到哨兵窗口日志，切换了新的主机)")]),s._v(" "),a("p",[s._v("哪个从机会被选举为主机呢？根据优先级别：slave-priority")]),s._v(" "),a("p",[s._v("原主机重启后会变为从机。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.12.39](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.12.39.png)")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"5"}},[a("li",[s._v("复制延时")])])]),s._v(" "),a("p",[s._v("由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。")]),s._v(" "),a("h4",{attrs:{id:"_13-4-2-故障恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-2-故障恢复"}},[s._v("#")]),s._v(" 13.4.2 故障恢复")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.13.19](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.13.19.png)")]),s._v(" "),a("p",[s._v("优先级在redis.conf中默认：slave-priority 100，值越小优先级越高")]),s._v(" "),a("p",[s._v("偏移量是指获得原主机数据最全的")]),s._v(" "),a("p",[s._v("每个redis实例启动后都会随机生成一个40位的runid")]),s._v(" "),a("h4",{attrs:{id:"_13-4-3-主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-3-主从复制"}},[s._v("#")]),s._v(" 13.4.3 主从复制")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisSentinelPool")]),s._v(" jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Jedis")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getJedisFromSentinel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Set")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" sentinelSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashSet")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sentinelSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.11.103:26379"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),s._v(" jedisPoolConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisPoolConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxTotal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最大可用连接数")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxIdle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最大闲置连接数")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMinIdle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//最小闲置连接数")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBlockWhenExhausted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//连接耗尽是否等待")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMaxWaitMillis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//等待时间")]),s._v("\n        jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTestOnBorrow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//取连接的时候进行一下测试 ping pong")]),s._v("\n\n        jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JedisSentinelPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mymaster"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sentinelSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("jedisPoolConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" jedisSentinelPool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"_14-redis集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-redis集群"}},[s._v("#")]),s._v(" 14. Redis集群")]),s._v(" "),a("p",[s._v("容量不够，redis如何进行扩容？")]),s._v(" "),a("p",[s._v("并发写操作， redis如何分摊？")]),s._v(" "),a("p",[s._v("另外，主从模式，薪火相传模式，主机宕机，导致ip地址发生变化，应用程序中配置需要修改对应的主机地址、端口等信息。")]),s._v(" "),a("p",[s._v("之前通过代理主机来解决，但是redis3.0中提供了解决方案。就是无中心化集群配置。")]),s._v(" "),a("h3",{attrs:{id:"_14-1-什么是集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-1-什么是集群"}},[s._v("#")]),s._v(" 14.1 什么是集群")]),s._v(" "),a("p",[s._v("Redis 集群实现了对Redis的水平扩容，即启动N个redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N。")]),s._v(" "),a("p",[s._v("Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。")]),s._v(" "),a("blockquote",[a("p",[s._v("删除持久化数据")])]),s._v(" "),a("p",[s._v("将rdb,aof文件都删除掉。")]),s._v(" "),a("h3",{attrs:{id:"_14-2-搭建步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-搭建步骤"}},[s._v("#")]),s._v(" 14.2 搭建步骤")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("制作  6  个实例，  6379,6380,6381,6389,6390,6391")])])]),s._v(" "),a("p",[s._v("配置基本信息")]),s._v(" "),a("p",[s._v("开启daemonize yes")]),s._v(" "),a("p",[s._v("Pid文件名字")]),s._v(" "),a("p",[s._v("指定端口")]),s._v(" "),a("p",[s._v("Log文件名字")]),s._v(" "),a("p",[s._v("Dump.rdb名字")]),s._v(" "),a("p",[s._v("Appendonly 关掉或者换名字")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("redis cluster配置修改")])])]),s._v(" "),a("p",[s._v("cluster-enabled yes  打开集群模式")]),s._v(" "),a("p",[s._v("cluster-config-file nodes-6379.conf 设定节点配置文件名")]),s._v(" "),a("p",[s._v("cluster-node-timeout 15000  设定节点失联时间，超过该时间（毫秒），集群自动进行主从切换。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("include /home/bigdata/redis.conf\nport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\npidfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/redis_6379.pid"')]),s._v("\ndbfilename "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dump6379.rdb"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/bigdata/redis_cluster"')]),s._v("\nlogfile "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/bigdata/redis_cluster/redis_err_6379.log"')]),s._v("\ncluster-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\ncluster-config-file nodes-6379.conf\ncluster-node-timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("修改好redis6379  .conf  文件  ，拷贝多个redis.conf文件")])])]),s._v(" "),a("p",[s._v("![image-20210720161852668](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.19.00.png)")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"4"}},[a("li",[s._v("使用查找替换修改另外  5  个文件")])])]),s._v(" "),a("p",[s._v("例如：:%s/6379/6380")]),s._v(" "),a("blockquote",[a("ol",{attrs:{start:"5"}},[a("li",[s._v("启动  6个  redis  服务")])])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.19.46](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.19.46.png)")]),s._v(" "),a("h3",{attrs:{id:"_14-3-将六个节点合成一个集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-3-将六个节点合成一个集群"}},[s._v("#")]),s._v(" 14.3 将六个节点合成一个集群")]),s._v(" "),a("p",[s._v("组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.20.27](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.20.27.png)")]),s._v(" "),a("p",[s._v("l 合体：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("  /opt/redis-6.2.1/src\nredis-cli --cluster create --cluster-replicas "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6379 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6380 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6381 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6389 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6390 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".11.101:6391\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("此处不要用127.0.0.1， 请用真实IP地址")]),s._v(" "),a("p",[s._v("--replicas 1 采用最简单的方式配置集群，一台主机，一台从机，正好三组。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720162106434.png",alt:"image-20210720162106434"}})]),s._v(" "),a("p",[s._v("![截屏2021-07-20 16.21.21](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 16.21.21.png)")]),s._v(" "),a("p",[s._v("l 普通方式登录")]),s._v(" "),a("p",[s._v("可能直接进入读主机，存储数据时，会出现MOVED重定向操作。所以，应该以集群方式登录。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720170720853.png",alt:"image-20210720170720853"}})]),s._v(" "),a("blockquote",[a("p",[s._v("-c 采用集群策略连接，设置数据会自动切换到相应的写主机")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720170824389.png",alt:"image-20210720170824389"}})]),s._v(" "),a("blockquote",[a("p",[s._v("通过 cluster nodes 命令查看集群信息")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720170830796.png",alt:"image-20210720170830796"}})]),s._v(" "),a("blockquote",[a("p",[s._v("redis cluster 如何分配这六个节点?")])]),s._v(" "),a("p",[s._v("一个集群至少要有三个主节点。")]),s._v(" "),a("p",[s._v("选项 --cluster-replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。")]),s._v(" "),a("p",[s._v("分配原则尽量保证每个主数据库运行在不同的IP地址，每个从库和主库不在一个IP地址上。")]),s._v(" "),a("h3",{attrs:{id:"_14-4-什么是-slots"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-4-什么是-slots"}},[s._v("#")]),s._v(" 14.4 什么是  slots")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个，")]),s._v(" "),a("p",[s._v("集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。")]),s._v(" "),a("p",[s._v("集群中的每个节点负责处理一部分插槽。 举个例子， 如果一个集群可以有主节点， 其中：")]),s._v(" "),a("p",[s._v("节点 A 负责处理 0 号至 5460 号插槽。")]),s._v(" "),a("p",[s._v("节点 B 负责处理 5461 号至 10922 号插槽。")]),s._v(" "),a("p",[s._v("节点 C 负责处理 10923 号至 16383 号插槽。")]),s._v(" "),a("h3",{attrs:{id:"_14-5-在集群中录入值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-5-在集群中录入值"}},[s._v("#")]),s._v(" 14.5 在集群中录入值")]),s._v(" "),a("p",[s._v("在redis-cli每次录入、查询键值，redis都会计算出该key应该送往的插槽，如果不是该客户端对应服务器的插槽，redis会报错，并告知应前往的redis实例地址和端口。")]),s._v(" "),a("p",[s._v("redis-cli客户端提供了 –c 参数实现自动重定向。")]),s._v(" "),a("p",[s._v("如 redis-cli  -c –p 6379 登入后，再录入、查询键值对可以自动重定向。")]),s._v(" "),a("p",[s._v("不在一个slot下的键值，是不能使用mget,mset等多键操作。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720170955876.png",alt:"image-20210720170955876"}})]),s._v(" "),a("p",[s._v("可以通过{}来定义组的概念，从而使key中{}内相同内容的键值对放到一个slot中去。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720171001787.png",alt:"image-20210720171001787"}})]),s._v(" "),a("h3",{attrs:{id:"_14-6-查询集群中的值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-6-查询集群中的值"}},[s._v("#")]),s._v(" 14.6 查询集群中的值")]),s._v(" "),a("p",[a("code",[s._v("CLUSTER GETKEYSINSLOT <slot><count>")]),s._v(" 返回 count 个 slot 槽中的键。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720171015977.png",alt:"image-20210720171015977"}})]),s._v(" "),a("h3",{attrs:{id:"_14-7-故障恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-7-故障恢复"}},[s._v("#")]),s._v(" 14.7 故障恢复")]),s._v(" "),a("p",[s._v("如果主节点下线？从节点能否自动升为主节点？注意： 15秒超时")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720171038483.png",alt:"image-20210720171038483"}})]),s._v(" "),a("p",[s._v("主节点恢复后，主从关系会如何？主节点回来变成从机。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720171042443.png",alt:"image-20210720171042443"}})]),s._v(" "),a("p",[s._v("如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续?")]),s._v(" "),a("p",[s._v("如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为yes ，那么 ，整个集群都挂掉")]),s._v(" "),a("p",[s._v("如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为no ，那么，该插槽数据全都不能使用，也无法存储。")]),s._v(" "),a("p",[s._v("redis.conf中的参数  cluster-require-full-coverage")]),s._v(" "),a("h3",{attrs:{id:"_14-8-集群的-jedis-开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-8-集群的-jedis-开发"}},[s._v("#")]),s._v(" 14.8 集群的  Jedis  开发")]),s._v(" "),a("p",[s._v("即使连接的不是主机，集群会自动切换主机存储。主机写，从机读。")]),s._v(" "),a("p",[s._v("无中心化主从集群。无论从哪台主机写的数据，其他主机上都能读到数据。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("public class JedisClusterTest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  public static void main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     Set"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("HostAndPort"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("set "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new HashSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("HostAndPort"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     set.add"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("new HostAndPort"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.211"')]),s._v(",6379"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     JedisCluster "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jedisCluster")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new JedisCluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     jedisCluster.set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     System.out.println"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jedisCluster.get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("Redis   集群提供了以下好处")])]),s._v(" "),a("ul",[a("li",[s._v("实现扩容")]),s._v(" "),a("li",[s._v("分摊压力")]),s._v(" "),a("li",[s._v("无中心配置相对简单")])]),s._v(" "),a("blockquote",[a("p",[s._v("Redis   集群的不足")])]),s._v(" "),a("p",[s._v("多键操作是不被支持的")]),s._v(" "),a("p",[s._v("多键的Redis事务是不被支持的。lua脚本不被支持")]),s._v(" "),a("p",[s._v("由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。")]),s._v(" "),a("h2",{attrs:{id:"_15-redis应用问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-redis应用问题解决"}},[s._v("#")]),s._v(" 15. Redis应用问题解决")]),s._v(" "),a("h3",{attrs:{id:"_15-1-缓存穿透"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-1-缓存穿透"}},[s._v("#")]),s._v(" 15.1 缓存穿透")]),s._v(" "),a("blockquote",[a("p",[s._v("问题描述")])]),s._v(" "),a("p",[s._v("key对应的数据在数据源并不存在，每次针对此key的请求从缓存获取不到，请求都会压到数据源，从而可能压垮数据源。比如用一个不存在的用户id获取用户信息，不论缓存还是数据库都没有，若黑客利用此漏洞进行攻击可能压垮数据库。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.12.17](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.12.17.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案")])]),s._v(" "),a("p",[s._v("一个一定不存在缓存及查询不到的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。")]),s._v(" "),a("p",[a("strong",[s._v("（1）")]),s._v("  对空值缓存： 如果一个查询返回的数据为空（不管是数据是否不存在），我们仍然把这个空结果（null）进行缓存，设置空结果的过期时间会很短，最长不超过五分钟")]),s._v(" "),a("p",[a("strong",[s._v("（2）")]),s._v("  设置可访问的名单（白名单）：")]),s._v(" "),a("p",[s._v("使用bitmaps类型定义一个可以访问的名单，名单id作为bitmaps的偏移量，每次访问和bitmap里面的id进行比较，如果访问id不在bitmaps里面，进行拦截，不允许访问。")]),s._v(" "),a("p",[a("strong",[s._v("（3）")]),s._v("  采用布隆过滤器 ：(布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量(位图)和一系列随机映射函数（哈希函数）。")]),s._v(" "),a("p",[s._v("布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。)")]),s._v(" "),a("p",[s._v("将所有可能存在的数据哈希到一个足够大的bitmaps中，一个一定不存在的数据会被 这个bitmaps拦截掉，从而避免了对底层存储系统的查询压力。")]),s._v(" "),a("p",[a("strong",[s._v("（4）")]),s._v("  进行实时监控： 当发现Redis的命中率开始急速降低，需要排查访问对象和访问的数据，和运维人员配合，可以设置黑名单限制服务")]),s._v(" "),a("h3",{attrs:{id:"_15-2-缓存击穿"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-2-缓存击穿"}},[s._v("#")]),s._v(" 15.2 缓存击穿")]),s._v(" "),a("blockquote",[a("p",[s._v("问题描述")])]),s._v(" "),a("p",[s._v("key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.13.30](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.13.30.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案")])]),s._v(" "),a("p",[s._v("key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题。")]),s._v(" "),a("p",[s._v("解决问题：")]),s._v(" "),a("p",[s._v("（1）预先设置热门数据： 在redis高峰访问之前，把一些热门数据提前存入到redis里面，加大这些热门数据key的时长")]),s._v(" "),a("p",[s._v("（2）实时调整： 现场监控哪些数据热门，实时调整key的过期时长")]),s._v(" "),a("p",[s._v("（3）使用锁：")]),s._v(" "),a("p",[s._v("（1） 就是在缓存失效的时候（判断拿出来的值为空），不是立即去load db。")]),s._v(" "),a("p",[s._v("（2） 先使用缓存工具的某些带成功操作返回值的操作（比如Redis的SETNX）去set一个mutex key")]),s._v(" "),a("p",[s._v("（3） 当操作返回成功时，再进行load db的操作，并回设缓存,最后删除mutex key；")]),s._v(" "),a("p",[s._v("（4） 当操作返回失败，证明有线程在load db，当前线程睡眠一段时间再重试整个get缓存的方法。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.14.03](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.14.03.png)")]),s._v(" "),a("h3",{attrs:{id:"_15-3-缓存雪崩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-3-缓存雪崩"}},[s._v("#")]),s._v(" 15.3 缓存雪崩")]),s._v(" "),a("blockquote",[a("p",[s._v("问题描述")])]),s._v(" "),a("p",[s._v("key对应的数据存在，但在redis中过期，此时若有大量并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。")]),s._v(" "),a("p",[s._v("缓存雪崩与缓存击穿的区别在于这里针对很多key缓存，前者则是某一个key")]),s._v(" "),a("ul",[a("li",[s._v("正常访问")])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.14.54](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.14.54.png)")]),s._v(" "),a("ul",[a("li",[s._v("缓存失效瞬间")])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.15.12](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.15.12.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案")])]),s._v(" "),a("p",[s._v("缓存失效时的雪崩效应对底层系统的冲击非常可怕！")]),s._v(" "),a("p",[a("strong",[s._v("（1）")]),s._v("  构建多级缓存架构： nginx缓存 + redis缓存 +其他缓存（ehcache等）")]),s._v(" "),a("p",[a("strong",[s._v("（2）")]),s._v("  使用锁或队列  ：")]),s._v(" "),a("p",[s._v("用加锁或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。不适用高并发情况")]),s._v(" "),a("p",[a("strong",[s._v("（3）")]),s._v("  设置过期标志更新缓存：")]),s._v(" "),a("p",[s._v("记录缓存数据是否过期（设置提前量），如果过期会触发通知另外的线程在后台去更新实际key的缓存。")]),s._v(" "),a("p",[a("strong",[s._v("（4）")]),s._v("  将缓存失效时间分散开：")]),s._v(" "),a("p",[s._v("比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。")]),s._v(" "),a("h3",{attrs:{id:"_15-4-分布式锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-4-分布式锁"}},[s._v("#")]),s._v(" 15.4 分布式锁")]),s._v(" "),a("blockquote",[a("p",[s._v("问题描述")])]),s._v(" "),a("p",[s._v("随着业务发展的需要，原单体单机部署的系统被演化成分布式集群系统后，由于分布式系统多线程、多进程并且分布在不同机器上，这将使原单机部署情况下的并发控制锁策略失效，单纯的Java API并不能提供分布式锁的能力。为了解决这个问题就需要一种跨JVM的互斥机制来控制共享资源的访问，这就是分布式锁要解决的问题！")]),s._v(" "),a("p",[s._v("分布式锁主流的实现方案：")]),s._v(" "),a("p",[s._v("\\1. 基于数据库实现分布式锁")]),s._v(" "),a("p",[s._v("\\2. 基于缓存（Redis等）")]),s._v(" "),a("p",[s._v("\\3. 基于Zookeeper")]),s._v(" "),a("p",[s._v("每一种分布式锁解决方案都有各自的优缺点：")]),s._v(" "),a("p",[s._v("\\1. 性能：redis最高")]),s._v(" "),a("p",[s._v("\\2. 可靠性：zookeeper最高")]),s._v(" "),a("p",[s._v("这里，我们就基于redis实现分布式锁。")]),s._v(" "),a("blockquote",[a("p",[s._v("解决方案：使用redis实现分布式锁")])]),s._v(" "),a("p",[s._v("redis:命令")]),s._v(" "),a("p",[s._v("# set sku:1:info “OK” NX PX 10000")]),s._v(" "),a("p",[s._v("EX second ：设置键的过期时间为 second 秒。 SET key value EX second 效果等同于 SETEX key second value 。")]),s._v(" "),a("p",[s._v("PX millisecond ：设置键的过期时间为 millisecond 毫秒。 SET key value PX millisecond 效果等同于 PSETEX key millisecond value 。")]),s._v(" "),a("p",[s._v("NX ：只在键不存在时，才对键进行设置操作。 SET key value NX 效果等同于 SETNX key value 。")]),s._v(" "),a("p",[s._v("XX ：只在键已经存在时，才对键进行设置操作。")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.16.33](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.16.33.png)")]),s._v(" "),a("p",[s._v("\\1. 多个客户端同时获取锁（setnx）")]),s._v(" "),a("p",[s._v("\\2. 获取成功，执行业务逻辑{从db获取数据，放入缓存}，执行完成释放锁（del）")]),s._v(" "),a("p",[s._v("\\3. 其他客户端等待重试")]),s._v(" "),a("h4",{attrs:{id:"编写代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写代码"}},[s._v("#")]),s._v(" 编写代码")]),s._v(" "),a("p",[s._v("Redis: set num 0")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testLock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1获取锁，setne")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Boolean")]),s._v(" lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setIfAbsent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"111"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2获取锁成功、查询num的值")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.1判断num为空return")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.2有值就转成成int")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.3把redis的num加1")]),s._v("\n        redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.4释放锁，del")]),s._v("\n        redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3获取锁失败、每隔0.1秒再获取")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("重启，服务集群，通过网关压力测试：")]),s._v(" "),a("p",[s._v("ab -n 1000 -c 100 http://192.168.140.1:8080/test/testLock")]),s._v(" "),a("p",[s._v("![image-20210720171731420](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.18.17.png)")]),s._v(" "),a("p",[s._v("查看redis中num的值：")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.17.59](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.17.59.png)")]),s._v(" "),a("p",[s._v("基本实现。")]),s._v(" "),a("p",[s._v("问题：setnx刚好获取到锁，业务逻辑出现异常，导致锁无法释放")]),s._v(" "),a("p",[s._v("解决：设置过期时间，自动释放锁。")]),s._v(" "),a("h4",{attrs:{id:"优化之设置锁的过期时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化之设置锁的过期时间"}},[s._v("#")]),s._v(" 优化之设置锁的过期时间")]),s._v(" "),a("p",[s._v("设置过期时间有两种方式：")]),s._v(" "),a("p",[s._v("\\1. 首先想到通过expire设置过期时间（缺乏原子性：如果在setnx和expire之间出现异常，锁也无法释放）")]),s._v(" "),a("p",[s._v("\\2. 在set时指定过期时间（推荐）")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.19.12](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.19.33.png)")]),s._v(" "),a("p",[s._v("设置过期时间：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720171953223.png",alt:"image-20210720171953223"}})]),s._v(" "),a("p",[s._v("压力测试肯定也没有问题。自行测试")]),s._v(" "),a("blockquote",[a("p",[s._v("问题：可能会释放其他服务器的锁。")])]),s._v(" "),a("p",[s._v("场景：如果业务逻辑的执行时间是7s。执行流程如下")]),s._v(" "),a("p",[s._v("\\1. index1业务逻辑没执行完，3秒后锁被自动释放。")]),s._v(" "),a("p",[s._v("\\2. index2获取到锁，执行业务逻辑，3秒后锁被自动释放。")]),s._v(" "),a("p",[s._v("\\3. index3获取到锁，执行业务逻辑")]),s._v(" "),a("p",[s._v("\\4. index1业务逻辑执行完成，开始调用del释放锁，这时释放的是index3的锁，导致index3的业务只执行1s就被别人释放。")]),s._v(" "),a("p",[s._v("最终等于没锁的情况。")]),s._v(" "),a("p",[s._v("解决：setnx获取锁时，设置一个指定的唯一值（例如：uuid）；释放前获取这个值，判断是否自己的锁")]),s._v(" "),a("h4",{attrs:{id:"优化之uuid防误删"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化之uuid防误删"}},[s._v("#")]),s._v(" 优化之UUID防误删")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.20.39](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.20.39.png)")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.20.58](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.20.58.png)")]),s._v(" "),a("blockquote",[a("p",[s._v("问题：删除操作缺乏原子性。")])]),s._v(" "),a("p",[s._v("场景：")]),s._v(" "),a("p",[s._v("\\1. index1执行删除时，查询到的lock值确实和uuid相等")]),s._v(" "),a("p",[s._v("uuid=v1")]),s._v(" "),a("p",[s._v("set(lock,uuid)；")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720172136459.png",alt:"image-20210720172136459"}})]),s._v(" "),a("p",[s._v("\\2. index1执行删除前，lock刚好过期时间已到，被redis自动释放")]),s._v(" "),a("p",[s._v("在redis中没有了lock，没有了锁。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720172141546.png",alt:"image-20210720172141546"}})]),s._v(" "),a("p",[s._v("\\3. index2获取了lock")]),s._v(" "),a("p",[s._v("index2线程获取到了cpu的资源，开始执行方法")]),s._v(" "),a("p",[s._v("uuid=v2")]),s._v(" "),a("p",[s._v("set(lock,uuid)；")]),s._v(" "),a("p",[s._v("\\4. index1执行删除，此时会把index2的lock删除")]),s._v(" "),a("p",[s._v("index1 因为已经在方法中了，所以不需要重新上锁。index1有执行的权限。index1已经比较完成了，这个时候，开始执行")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720172150033.png",alt:"image-20210720172150033"}})]),s._v(" "),a("p",[s._v("删除的index2的锁！")]),s._v(" "),a("h4",{attrs:{id:"优化之lua脚本保证删除的原子性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化之lua脚本保证删除的原子性"}},[s._v("#")]),s._v(" 优化之LUA脚本保证删除的原子性")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testLockLua"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLockLua")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1 声明一个uuid ,将做为一个value 放入我们的key所对应的值中")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" uuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2 定义一个锁：lua 脚本可以使用同一把锁，来实现删除！")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" skuId "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"25"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 访问skuId 为25号的商品 100008348542")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" locKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock:"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" skuId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 锁住的是每个商品的数据")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3 获取锁")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Boolean")]),s._v(" lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setIfAbsent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("locKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第一种： lock 与过期时间中间不写任何的代码。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// redisTemplate.expire("lock",10, TimeUnit.SECONDS);//设置过期时间')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 执行的业务逻辑开始")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取缓存中的num 数据")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果是空直接返回")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不是空 如果说在这出现了异常！ 那么delete 就删除失败！ 也就是说锁永远存在！")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" num "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parseInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使num 每次+1 放入缓存")]),s._v("\n        redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"num"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("valueOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("num"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*使用lua脚本来锁*/")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义lua 脚本")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用redis执行lua执行")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultRedisScript")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" redisScript "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultRedisScript")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        redisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setScriptText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置一下返回值类型 为Long")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 因为删除判断的时候，返回的0,给其封装为数据类型。如果不封装那么默认返回String 类型，")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 那么返回字符串与0 会有发生错误。")]),s._v("\n        redisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setResultType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第一个要是script 脚本 ，第二个需要判断的key，第三个就是key所对应的值。")]),s._v("\n        redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Arrays")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("asList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("locKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 其他线程等待")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 睡眠")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 睡醒了之后，调用方法。")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLockLua")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("p",[s._v("Lua 脚本详解：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720172222671.png",alt:"image-20210720172222671"}})]),s._v(" "),a("p",[s._v("项目中正确使用：")]),s._v(" "),a("ol",[a("li",[s._v("定义key，key应该是为每个sku定义的，也就是每个sku有一把锁。")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" locKey "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock:"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("skuId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//锁住的是每个商品的数据Boolean lock =  redisTemplate .opsForValue().setIfAbsent(locKey, uuid,3,TimeUnit. );")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720172249701.png",alt:"image-20210720172249701"}})]),s._v(" "),a("h4",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ol",[a("li",[s._v("加锁")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 从redis中获取锁,set k1 v1 px 20000 nx")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" uuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Boolean")]),s._v(" lock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("redisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("opsForValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setIfAbsent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("使用lua释放锁")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 释放锁 del")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置lua脚本返回的数据类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultRedisScript")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" redisScript "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultRedisScript")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置lua脚本返回类型为Long")]),s._v("\nredisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setResultType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nredisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setScriptText")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nredisTemplate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("redisScript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Arrays")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("asList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lock"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("uuid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("重试")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("为了确保分布式锁可用，我们至少要确保锁的实现同时 满足以下四个条件 ：")]),s._v(" "),a("p",[s._v("- 互斥性。在任意时刻，只有一个客户端能持有锁。")]),s._v(" "),a("p",[s._v("- 不会发生死锁。即使有一个客户端在持有锁的期间崩溃而没有主动解锁，也能保证后续其他客户端能加锁。")]),s._v(" "),a("p",[s._v("- 解铃还须系铃人。加锁和解锁必须是同一个客户端，客户端自己不能把别人加的锁给解了。")]),s._v(" "),a("p",[s._v("- 加锁和解锁必须具有原子性。")]),s._v(" "),a("h2",{attrs:{id:"_16-redis-6-0-新功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-redis-6-0-新功能"}},[s._v("#")]),s._v(" 16. Redis  6.0  新功能")]),s._v(" "),a("h3",{attrs:{id:"_16-1-acl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-1-acl"}},[s._v("#")]),s._v(" 16.1 ACL")]),s._v(" "),a("p",[s._v("Redis ACL是Access Control List（访问控制列表）的缩写，该功能允许根据可以执行的命令和可以访问的键来限制某些连接。")]),s._v(" "),a("p",[s._v("在Redis 5版本之前，Redis 安全规则只有密码控制 还有通过rename 来调整高危命令比如 flushdb ， KEYS* ， shutdown 等。Redis 6 则提供ACL的功能对用户进行更细粒度的权限控制 ：")]),s._v(" "),a("p",[s._v("（1）接入权限:用户名和密码")]),s._v(" "),a("p",[s._v("（2）可以执行的命令")]),s._v(" "),a("p",[s._v("（3）可以操作的 KEY")]),s._v(" "),a("p",[s._v("参考官网：https://redis.io/topics/acl")]),s._v(" "),a("h4",{attrs:{id:"commands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commands"}},[s._v("#")]),s._v(" Commands")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("使用acl list命令展现用户权限列表")]),s._v(" "),a("p",[s._v("a. 数据说明")])])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.39.55](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.39.55.png)")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("使用acl cat命令")]),s._v(" "),a("p",[s._v("a. 查看添加权限指令类别")])])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.41.29](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.41.29.png)")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[s._v("\tb. 加参数类型名可以查看类型下具体命令\n")])])]),a("p",[s._v("![截屏2021-07-20 17.43.18](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.43.18.png)")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("使用acl whoami命令查看当前用户")])]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.42.18](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.42.18.png)")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[s._v("使用aclsetuser命令创建和编辑用户ACL")]),s._v(" "),a("p",[s._v("a. ACL规则")])])]),s._v(" "),a("p",[s._v("下面是有效ACL规则的列表。某些规则只是用于激活或删除标志，或对用户ACL执行给定更改的单个单词。其他规则是字符前缀，它们与命令或类别名称、键模式等连接在一起。")]),s._v(" "),a("blockquote",[a("p",[s._v("ACL规则")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("类型")]),s._v(" "),a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("启动和禁用用户")]),s._v(" "),a("td",[s._v("on")]),s._v(" "),a("td",[s._v("激活某用户账号")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("off")]),s._v(" "),a("td",[s._v("禁用某用户账号。注意，已验证的连接仍然可以工作。如果默认用户被标记为off，则新连接将在未进行身份验证的情况下启动，并要求用户使用AUTH选项发送AUTH或HELLO，以便以某种方式进行身份验证。")])]),s._v(" "),a("tr",[a("td",[s._v("权限的添加删除")]),s._v(" "),a("td",[a("code",[s._v("+<command>")])]),s._v(" "),a("td",[s._v("将指令添加到用户可以调用的指令列表中")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("code",[s._v("-<command>")])]),s._v(" "),a("td",[s._v("从用户可执行指令列表移除指令")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("code",[s._v("+@<category>")])]),s._v(" "),a("td",[s._v("添加该类别中用户要调用的所有指令，有效类别为@admin、@set、@sortedset…等，通过调用ACL CAT命令查看完整列表。特殊类别@all表示所有命令，包括当前存在于服务器中的命令，以及将来将通过模块加载的命令。")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("code",[s._v("-@<actegory>")])]),s._v(" "),a("td",[s._v("从用户可调用指令中移除类别")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("code",[s._v("allcommands")])]),s._v(" "),a("td",[s._v("+@all的别名")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("code",[s._v("nocommand")])]),s._v(" "),a("td",[s._v("-@all的别名")])]),s._v(" "),a("tr",[a("td",[s._v("可操作键的添加或删除")]),s._v(" "),a("td",[a("code",[s._v("-<pattern>")])]),s._v(" "),a("td",[s._v("添加可作为用户可操作的键的模式。例如~*允许所有的键")])])])]),s._v(" "),a("p",[s._v("​        b. 通过命令创建新用户默认权限")]),s._v(" "),a("p",[s._v("acl setuser user1")]),s._v(" "),a("p",[s._v("![截屏2021-07-20 17.47.49](/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/截屏2021-07-20 17.47.49.png)")]),s._v(" "),a("p",[s._v("在上面的示例中，我根本没有指定任何规则。如果用户不存在，这将使用just created的默认属性来创建用户。如果用户已经存在，则上面的命令将不执行任何操作。")]),s._v(" "),a("p",[s._v("​        c. 设置有用户名、密码、ACL权限、并启用的用户")]),s._v(" "),a("p",[s._v("acl setuser user2 on >password ~cached:* +get")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720174848346.png",alt:"image-20210720174848346"}})]),s._v(" "),a("p",[s._v("​        d. 切换用户，验证权限")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720174901045.png",alt:"image-20210720174901045"}})]),s._v(" "),a("h3",{attrs:{id:"_16-2-io多线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-2-io多线程"}},[s._v("#")]),s._v(" 16.2 IO多线程")]),s._v(" "),a("p",[s._v("Redis6终于支撑多线程了，告别单线程了吗？")]),s._v(" "),a("p",[s._v("IO多线程其实指 客户端交互部分 的 网络IO 交互处理模块 多线程 ，而非 执行命令多线程 。Redis6执行命令依然是单线程。")]),s._v(" "),a("h4",{attrs:{id:"_16-2-1-原理架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-2-1-原理架构"}},[s._v("#")]),s._v(" 16.2.1 原理架构")]),s._v(" "),a("p",[s._v("Redis 6 加入多线程,但跟 Memcached 这种从 IO处理到数据访问多线程的实现模式有些差异。Redis 的多线程部分只是用来处理网络数据的读写和协议解析，执行命令仍然是单线程。之所以这么设计是不想因为多线程而变得复杂，需要去控制 key、lua、事务，LPUSH/LPOP 等等的并发问题。整体的设计大体如下:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175021863.png",alt:"image-20210720175021863"}})]),s._v(" "),a("p",[s._v("另外，多线程IO默认也是不开启的，需要再配置文件中配置")]),s._v(" "),a("p",[s._v("io-threads-do-reads  yes")]),s._v(" "),a("p",[s._v("io-threads 4")]),s._v(" "),a("h3",{attrs:{id:"_16-3-工具支持-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-工具支持-cluster"}},[s._v("#")]),s._v(" 16.3 工具支持 Cluster")]),s._v(" "),a("p",[s._v("之前老版Redis想要搭集群需要单独安装ruby环境，Redis 5 将 redis-trib.rb 的功能集成到 redis-cli 。另外官方 redis-benchmark 工具开始支持 cluster 模式了，通过多线程的方式对多个分片进行压测。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/Users/wuxiaoqi/Blog/Markdowns/folder/BackEnd/MiddleWire/typora-user-images/image-20210720175045762.png",alt:"image-20210720175045762"}})]),s._v(" "),a("h3",{attrs:{id:"_16-4-redis新功能持续关注"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-4-redis新功能持续关注"}},[s._v("#")]),s._v(" 16.4 Redis新功能持续关注")]),s._v(" "),a("p",[s._v("Redis6新功能还有：")]),s._v(" "),a("p",[s._v("1、RESP3新的 Redis 通信协议：优化服务端与客户端之间通信")]),s._v(" "),a("p",[s._v("2、Client side caching客户端缓存：基于 RESP3 协议实现的客户端缓存功能。为了进一步提升缓存的性能，将客户端经常访问的数据cache到客户端。减少TCP网络交互。")]),s._v(" "),a("p",[s._v("3、Proxy集群代理模式：Proxy 功能，让 Cluster 拥有像单实例一样的接入方式，降低大家使用cluster的门槛。不过需要注意的是代理不改变 Cluster 的功能限制，不支持的命令还是不会支持，比如跨 slot 的多Key操作。")]),s._v(" "),a("p",[s._v("4、Modules API")]),s._v(" "),a("p",[s._v("Redis 6中模块API开发进展非常大，因为Redis Labs为了开发复杂的功能，从一开始就用上Redis模块。Redis可以变成一个框架，利用Modules来构建不同系统，而不需要从头开始写然后还要BSD许可。Redis一开始就是一个向编写各种系统开放的平台。")]),s._v(" "),a("h2",{attrs:{id:"nosql数据库简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql数据库简介"}},[s._v("#")]),s._v(" NoSQL数据库简介")]),s._v(" "),a("h3",{attrs:{id:"技术发展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术发展"}},[s._v("#")]),s._v(" 技术发展")]),s._v(" "),a("blockquote",[a("p",[s._v("技术的分类")])]),s._v(" "),a("ol",[a("li",[s._v("解决功能性的问题：Java、Jsp、RDBMS、Tomcat、HTML、Linux、JDBC、SVN")]),s._v(" "),a("li",[s._v("解决扩展性的问题：Struts、Spring、SpringMVC、Hibernate、Mybatis")]),s._v(" "),a("li",[s._v("解决性能的问题：NoSQL、Java线程、Hadoop、Nginx、MQ、ElasticSearch")])]),s._v(" "),a("h4",{attrs:{id:"web1-0-时代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web1-0-时代"}},[s._v("#")]),s._v(" Web1.0  时代")]),s._v(" "),a("p",[s._v("Web1.0的时代，数据访问量很有限，用一夫当关的高性能的单点服务器可以解决大部分问题。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0_1.png",alt:"截屏2021-07-15 14.11.26"}})]),s._v(" "),a("h4",{attrs:{id:"web2-0-时代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web2-0-时代"}},[s._v("#")]),s._v(" Web2.0  时代")]),s._v(" "),a("p",[s._v("随着Web2.0的时代的到来，用户访问量大幅度提升，同时产生了量的用户数据。加上后来的智能移动设备的普及，所有的互联网平台都面临了巨大的性能挑战。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.1_2.png",alt:"截屏2021-07-15 14.11.45"}})]),s._v(" "),a("h4",{attrs:{id:"解决-cpu及内存压力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决-cpu及内存压力"}},[s._v("#")]),s._v(" 解决 CPU及内存压力")]),s._v(" "),a("h4",{attrs:{id:"解决-io压力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决-io压力"}},[s._v("#")]),s._v(" "),a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.1_3.png",alt:"截屏2021-07-15 14.12.02"}}),s._v("解决 IO压力")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.1_4.png",alt:"截屏2021-07-15 14.13.13"}})]),s._v(" "),a("h3",{attrs:{id:"nosql-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql-数据库"}},[s._v("#")]),s._v(" NoSQL  数据库")]),s._v(" "),a("h4",{attrs:{id:"nosql数据库概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql数据库概述"}},[s._v("#")]),s._v(" NoSQL数据库概述")]),s._v(" "),a("p",[a("code",[s._v("NoSQL")]),s._v("(NoSQL =  Not Only SQL  )，意即“不仅仅是SQL”，泛指 非关系型的数据库 。")]),s._v(" "),a("p",[a("code",[s._v("NoSQL")]),s._v(" 不依赖业务逻辑方式存储，而以简单的"),a("code",[s._v("key-value")]),s._v("模式存储。因此大大的增加了数据库的扩展能力。")]),s._v(" "),a("ul",[a("li",[s._v("不遵循"),a("code",[s._v("SQL")]),s._v("标准")]),s._v(" "),a("li",[s._v("不支持"),a("code",[s._v("ACID")])]),s._v(" "),a("li",[s._v("远超于"),a("code",[s._v("SQL")]),s._v("的性能")])]),s._v(" "),a("h4",{attrs:{id:"nosql适用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql适用场景"}},[s._v("#")]),s._v(" NoSQL适用场景")]),s._v(" "),a("ul",[a("li",[s._v("对数据高并发的读写")]),s._v(" "),a("li",[s._v("海量数据的读写")]),s._v(" "),a("li",[s._v("对数据高可扩展性的")])]),s._v(" "),a("h4",{attrs:{id:"nosql不适用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql不适用场景"}},[s._v("#")]),s._v(" NoSQL不适用场景")]),s._v(" "),a("ul",[a("li",[s._v("需要事务支持")]),s._v(" "),a("li",[s._v("基于"),a("code",[s._v("SQL")]),s._v("的结构化查询存储，处理复杂的关系,需要即席查询。")]),s._v(" "),a("li",[s._v("（用不着"),a("code",[s._v("SQL")]),s._v("的和用了"),a("code",[s._v("SQL")]),s._v("也不行的情况，请考虑用NoSql）")])]),s._v(" "),a("blockquote",[a("h4",{attrs:{id:"memcached"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#memcached"}},[s._v("#")]),s._v(" Memcached")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/Memcached.png",alt:"截屏2021-07-15 14.17.39"}})]),s._v(" "),a("ul",[a("li",[s._v("很早出现的"),a("code",[s._v("NoSQL")]),s._v("数据库")]),s._v(" "),a("li",[s._v("数据都在内存中，一般不持久化")]),s._v(" "),a("li",[s._v("支持简单的"),a("code",[s._v("key-value")]),s._v("模式，支持类型单一")]),s._v(" "),a("li",[s._v("一般是作为缓存数据库辅助持久化的数据库")])]),s._v(" "),a("blockquote",[a("h4",{attrs:{id:"redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/Redis.png",alt:"截屏2021-07-15 14.25.50"}})]),s._v(" "),a("ul",[a("li",[s._v("几乎覆盖了"),a("code",[s._v("Memcached")]),s._v("的绝大部分功能")]),s._v(" "),a("li",[s._v("数据都在内存中，支持持久化，主要用作备份恢复")]),s._v(" "),a("li",[s._v("除了支持简单的"),a("code",[s._v("key-value")]),s._v("模式，还支持多种数据结构的存储，比如 list、set、hash、zset等。")]),s._v(" "),a("li",[s._v("一般是作为缓存数据库辅助持久化的数据库")])]),s._v(" "),a("blockquote",[a("h4",{attrs:{id:"mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[s._v("#")]),s._v(" MongoDB")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/mongoDB.png",alt:"截屏2021-07-15 14.24.40"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("高性能、开源、模式自由(schema  free)的 文档型数据库")])]),s._v(" "),a("li",[a("p",[s._v("数据都在内存中， 如果内存不足，把不常用的数据保存到硬盘ü 虽然是key-value模式，但是对value（尤其是 json ）提供了丰富的查询功能")])]),s._v(" "),a("li",[a("p",[s._v("支持二进制数据及大型对象")])]),s._v(" "),a("li",[a("p",[s._v("可以根据数据的特点 替代RDBMS  ，成为独立的数据库。或者配合RDBMS，存储特定的数据。")])])]),s._v(" "),a("h3",{attrs:{id:"行列式存储数据库-大数据时代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行列式存储数据库-大数据时代"}},[s._v("#")]),s._v(" 行列式存储数据库（大数据时代）")]),s._v(" "),a("h4",{attrs:{id:"行式数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行式数据库"}},[s._v("#")]),s._v(" 行式数据库")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.3_1.png",alt:"image-20210715144750852"}})]),s._v(" "),a("h4",{attrs:{id:"列式数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列式数据库"}},[s._v("#")]),s._v(" 列式数据库")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.3_2.png",alt:"截屏2021-07-15 14.48.55"}})]),s._v(" "),a("blockquote",[a("h5",{attrs:{id:"hbase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hbase"}},[s._v("#")]),s._v(" Hbase")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://hbase.apache.org/images/hbase_logo_with_orca_large.png",alt:"Apache HBase"}})]),s._v(" "),a("p",[s._v("HBase是 Hadoop 项目中的数据库。它用于需要对大量的数据进行随机、实时的读写操作的场景中。")]),s._v(" "),a("p",[s._v("HBase的目标就是处理数据量 非常庞大 的表，可以用 普通的计算机 处理超过 10亿行数据 ，还可处理有数百万 列 元素的数据表。")]),s._v(" "),a("blockquote",[a("h5",{attrs:{id:"cassandra-kəˈsændrə"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cassandra-kəˈsændrə"}},[s._v("#")]),s._v(" Cassandra [kəˈsændrə]")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/Cassandra.png",alt:"img"}})]),s._v(" "),a("p",[s._v("Apache Cassandra是一款免费的开源NoSQL数据库，其设计目的在于管理由大量商用服务器构建起来的庞大集群上的 海量数据集(数据量通常达到  PB  级别  ) 。在众多显著特性当中，Cassandra最为卓越的长处是对写入及读取操作进行规模调整，而且其不强调主集群的设计思路能够以相对直观的方式简化各集群的创建与扩展流程。")]),s._v(" "),a("blockquote",[a("p",[s._v("计算机存储单位 计算机存储单位一般用B，KB，MB，GB，TB，EB，ZB，YB，BB来表示，它们之间的关系是：")])]),s._v(" "),a("p",[s._v("位 bit (比特)(Binary Digits)：存放一位二进制数，即 0 或 1，最小的存储单位。字节 byte：8个二进制位为一个字节(B)，最常用的单位。1KB (Kilobyte 千字节)=1024B，1MB (Megabyte 兆字节 简称“兆”)=1024KB，1GB (Gigabyte 吉字节 又称“千兆”)=1024MB，1TB (Trillionbyte 万亿字节 太字节)=1024GB，其中1024=2^10 ( 2 的10次方)，1PB（Petabyte 千万亿字节 拍字节）=1024TB，1EB（Exabyte 百亿亿字节 艾字节）=1024PB，1ZB (Zettabyte 十万亿亿字节 泽字节)= 1024 EB,1YB (Jottabyte 一亿亿亿字节 尧字节)= 1024 ZB,1BB (Brontobyte 一千亿亿亿字节)= 1024 YB.注：“兆”为百万级数量单位。")]),s._v(" "),a("h3",{attrs:{id:"图关系型数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图关系型数据库"}},[s._v("#")]),s._v(" 图关系型数据库")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/neo4j.png",alt:"截屏2021-07-15 14.58.28"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.4_1.png",alt:"image-20210715145716913"}})]),s._v(" "),a("p",[s._v("主要应用：社会关系，公共交通网络，地图及网络拓谱"),a("code",[s._v("(n*(n-1)/2)")])]),s._v(" "),a("h3",{attrs:{id:"db-engines-数据库排名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#db-engines-数据库排名"}},[s._v("#")]),s._v(" DB-Engines 数据库排名")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://db-engines.com/en/ranking",target:"_blank",rel:"noopener noreferrer"}},[s._v(" http://db-engines.com/en/ranking "),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/WWWWWWWXQ/images/raw/master/Redis/0.5_1.png",alt:"image-20210715145914522"}})]),s._v(" "),a("hr")])}),[],!1,null,null,null);t.default=e.exports}}]);